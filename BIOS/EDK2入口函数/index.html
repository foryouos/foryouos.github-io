<!-- build time: Mon Aug 14 2023 23:21:17 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><meta name="baidu-site-verification" content="codeva-yIAXMzOV6I"><meta name="referrer" content="never"><link rel="alternate" href="/rss.xml" title="瓶子的跋涉" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="瓶子的跋涉" type="application/atom+xml"><link rel="alternate" type="application/json" title="瓶子的跋涉" href="https://www.blog.foryouos.cn/feed.json"><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.3.3"><script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.js"></script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><meta name="keywords" content="BIOS,EDK2"><link rel="canonical" href="https://www.blog.foryouos.cn/BIOS/EDK2%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0/"><title>EDK2入口函数</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">EDK2入口函数</h1><div class="meta"><span class="item" title="创建时间：2023-08-12 07:55:00"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2023-08-12T07:55:00+08:00">2023-08-12</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>15k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>14 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">foryouos</a></li></ul><ul class="right" id="rightNav"><li class="item theme" @click="changeThemeByBtn"><i class="ic" :class="{'i-sun': !themeStatus,'i-moon': themeStatus}"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://mmbiz.qpic.cn/mmbiz_jpg/ORog4TEnkbvthkUaBMX9zWiccSLd09Nd7QWjU01Y3YMYJRtKEefGuR04GQ7MUxESjklibXG4ibibxAYZvpbYKYXEPQ/640?wx_fmt=jpeg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/BIOS/" itemprop="item" rel="index" title="分类于BIOS"><span itemprop="name">BIOS<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.blog.foryouos.cn/BIOS/EDK2%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"><meta itemprop="name" content="YuHeShui"><meta itemprop="description" content="YuHeShui, 瓶子的跋涉 &amp; 编程笔记"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="瓶子的跋涉"></span><div class="body md" itemprop="articleBody"><h1 id="入口函数"><a class="anchor" href="#入口函数">#</a> 入口函数</h1><blockquote><p>一个简单的 <code>UEFI程序</code> ， <code>至少</code> 包含 <code>两个</code> 部分</p><ul><li><code>C程序源文</code> 件 ： 用来实现 <code>具体功能</code> ，在复杂程序中源文件可能包含： <code>C/C++源代码</code> ， <code>.asm汇编文件</code> (.s 汇编文件， <code>uin资源</code> 文件 (字符串资源文件) 和 <code>.vfr</code> 资源文件)</li><li><code>INF元数据</code> 文件用来编译代码</li></ul></blockquote><h2 id="入口函数返回值类型efi_status"><a class="anchor" href="#入口函数返回值类型efi_status">#</a> 入口函数返回值类型 <code>EFI_STATUS</code></h2><blockquote><ul><li>在 <code>UEFI</code> 中基本所有的返回值类型都是 <code>EFI_STATUS</code> , 其本质是 <code>无符号长整数</code></li><li>最高位为 <code>1</code> 时其值为 <code>错误代码</code> ，为 <code>0</code> 表示 <code>正确</code> 。听过 <code>宏EFI_ERROR(Status)</code> 可以判断 <code>返回值Status</code></li></ul></blockquote><h2 id="头文件"><a class="anchor" href="#头文件">#</a> 头文件</h2><blockquote><ul><li><code>&lt;Uefi.h&gt;</code> : 定义了 <code>UEFI</code> 中的基本 <code>数据类型</code> 和 <code>核心数据结构</code></li><li><code>&lt;Library/UefiLib.h&gt;</code> : 提供通用的 <code>库函数</code> ，包括 <code>时间</code> ， <code>简单锁</code> ， <code>任务优先级</code> ， <code>驱动管理和字符</code> ， <code>图形显示输出</code> 等基本功能</li><li><code>&lt;Library/BaseLib.h&gt;</code> : 提供 <code>字符串处理</code> ， <code>数学</code> ， <code>文件路径处理</code> 等相关库函数</li><li><code>&lt;Library/BaseMemoryLib.h&gt;</code> : 提供 <code>内存的库函数</code> ，包括 <code>内存拷贝</code> ， <code>内存填充</code> ， <code>内存清空</code> 等库函数</li><li><code>&lt;Library/DebugLib.h&gt;</code> ：提供 <code>调试输出</code> 功能的库函数</li></ul></blockquote><h1 id="efi文件"><a class="anchor" href="#efi文件">#</a> <code>efi</code> 文件</h1><blockquote><p><code>.efi</code> 文件 ( <code>UEFI应用程序</code> 或 <code>UEFI驱动程序</code> ) 加载到内存后生成的对象成为 <code>Image</code> 映像)。 <code>ImageHandle</code> 是 <code>Image</code> 对象的句柄，作为模版入口函数参数，它表示 <code>模块自身</code> 加载到内存后生成的 <code>Image对象</code> 。</p><p><code>UEFI Image</code> 通常存储在文件系统中，可以是 <code>.efi</code> 文件或一个文件夹，包含 <code>多个.efi</code> 文件，UEFI Image 可以包含 <code>UEFI BIOS</code> 的一些功能模块和驱动程序，也可以是一个 UEFI 应用程序或操作系统的引导程序。当 UEFI 启动时，UEFI Loader 会加载 UEFI Image 到内存中，并执行其中的代码来启动系统。</p><p>在 <code>UEFI</code> 中， <code>映像</code> 通常指的是 <code>内存映像</code> ，用于表示一个进程或操作系统执行时的内存状态。例如，在 UEFI 内存取证中，可以通过获取系统的内存映像来分析系统的运行状态和数据。</p></blockquote><h2 id="guid"><a class="anchor" href="#guid">#</a> <code>GUID</code></h2><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  UINT32    Data1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  UINT16    Data2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  UINT16    Data3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  UINT8     Data4<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span> GUID<span class="token punctuation">;</span></pre></td></tr></table></figure><h1 id="字符量"><a class="anchor" href="#字符量">#</a> 字符量</h1><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="2"></td><td><pre>__int64 的最大值：9223372036854775807</pre></td></tr><tr><td data-num="3"></td><td><pre>__int64 的最小值：-9223372036854775808</pre></td></tr><tr><td data-num="4"></td><td><pre>unsigned __int64 的最大值：18446744073709551615</pre></td></tr><tr><td data-num="5"></td><td><pre>*/</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> __int64  UINT64<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">typedef</span> __int64           INT64<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> __int32  UINT32<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">typedef</span> __int32           INT32<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="11"></td><td><pre> unsigned short [int] 的字节数位 2，取值范围是 0 ~ 2^16-1，即 0 ~ 65535</pre></td></tr><tr><td data-num="12"></td><td><pre>*/</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span>    UINT16<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span>    CHAR16<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// 短整型 -32768 ~ +32767</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">short</span>             INT16<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 无符号字符型 unsigned  0~255</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span>     BOOLEAN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span>     UINT8<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">// 字符型 char 取值范围 -128 ~ +127</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">char</span>              CHAR8<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">// 有符号字符类型 -128 到 127</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">signed</span> <span class="token keyword">char</span>       INT8<span class="token punctuation">;</span></pre></td></tr></table></figure><h1 id="工程结构"><a class="anchor" href="#工程结构">#</a> 工程结构</h1><ul><li><code>Pkg</code> 是 <code>Package</code> 的缩写， <code>包</code> 的意思</li><li><code>EDK2</code> 模块化，每个 <code>Pkg</code> 都是一个 <code>解决方案</code></li><li><code>build</code> 保存着 <code>Pkg编译</code> 的结果</li><li><code>Conf</code> 保存各种 <code>配置文</code> 件， <code>target.txt</code> 编译目标，</li><li><code>edksetup.bat脚本</code></li><li><code>dsc</code> 是对 <code>整个包的描述</code></li><li><code>dec</code> 是 <code>定义公开</code> 的 <code>内容</code> 和 <code>接口</code> ，是 UEFI 接口的实现</li></ul><h1 id="启动edk2"><a class="anchor" href="#启动edk2">#</a> 启动 EDK2</h1><blockquote><p><code>EDK2</code> 是实现 <code>UEFI</code> 的源码</p><p><code>build</code> 构建之后，进入对应的如下页面，启动 <code>WinHost.exe</code> 文件。</p></blockquote><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>D:<span class="token punctuation">\</span>edk2<span class="token punctuation">\</span>Build<span class="token punctuation">\</span>EmulatorX64<span class="token punctuation">\</span>DEBUG_VS2019<span class="token punctuation">\</span>X64</pre></td></tr></table></figure><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># U 盘的文件系统为 FAT32 系统 I 会首先检查下面目录寻找，作为启动</span></pre></td></tr><tr><td data-num="2"></td><td><pre>EFI/Boot/BootX64.efi</pre></td></tr></table></figure><h1 id="第一个hello-word"><a class="anchor" href="#第一个hello-word">#</a> 第一个 Hello Word</h1><blockquote><p>一个基本的 <code>UEFI程序</code> 需要包括 <code>.c文件</code> ，以及 <code>.inf文件模块</code> 工程文件，描述模块的 <code>属性</code> ， <code>提供依赖库</code> ，支持的 <code>CPU架构</code> 等信息。</p></blockquote><h2 id="存储内容"><a class="anchor" href="#存储内容">#</a> 存储内容</h2><ul><li><code>EDK2文件夹</code> 下分为两个文件 <code>edk2</code> 和 <code>edk2-libc</code></li><li>在 <code>EDK2文件夹</code> 下创建 <code>mybuild.bat,</code> 设置基本 <code>环境配置</code></li></ul><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>set WORKSPACE<span class="token operator">=</span><span class="token operator">%</span>CD<span class="token operator">%</span></pre></td></tr><tr><td data-num="2"></td><td><pre>set EDK_TOOLS_PATH<span class="token operator">=</span><span class="token operator">%</span>CD<span class="token operator">%</span>\edk2\BaseTools</pre></td></tr><tr><td data-num="3"></td><td><pre>set CONF_PATH<span class="token operator">=</span><span class="token operator">%</span>CD<span class="token operator">%</span>\edk2\Conf</pre></td></tr><tr><td data-num="4"></td><td><pre>set PACKAGES_PATH<span class="token operator">=</span><span class="token operator">%</span>CD<span class="token operator">%</span>\edk2<span class="token punctuation">;</span><span class="token operator">%</span>CD<span class="token operator">%</span>\edk2<span class="token operator">-</span>lib</pre></td></tr></table></figure><ul><li>在根目录的 <code>AppPkg</code> 目录 <code>Applications</code> 目录下创建目录</li><li>分别创建 <code>.c</code> 和 <code>.inf</code> 文件</li><li>在 <code>Application</code> 同级目录的 <code>AppPkg.dsc</code> 文件中添加文件 <code>.inf模块</code> 工程文件 <code>内容</code></li></ul><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>Components<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  AppPkg<span class="token operator">/</span>Applications<span class="token operator">/</span>ShellApp_Main<span class="token operator">/</span>ShellApp_Main<span class="token punctuation">.</span>inf</pre></td></tr><tr><td data-num="3"></td><td><pre>  AppPkg<span class="token operator">/</span>Applications<span class="token operator">/</span>Stdlib_Main<span class="token operator">/</span>Stdlib_Main<span class="token punctuation">.</span>inf    </pre></td></tr><tr><td data-num="4"></td><td><pre>  AppPkg<span class="token operator">/</span>Applications<span class="token operator">/</span>Uefi_Main<span class="token operator">/</span>Uefi_Main<span class="token punctuation">.</span>inf</pre></td></tr></table></figure><h2 id="入口函数-2"><a class="anchor" href="#入口函数-2">#</a> 入口函数</h2><h3 id="uefi_mainc"><a class="anchor" href="#uefi_mainc">#</a> <code>Uefi_Main.c</code></h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/** @file</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  This is Sample of UEFI aplication. </pre></td></tr><tr><td data-num="3"></td><td><pre> * **/</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Uefi.h></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Library/UefiLib.h></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  The user Entry Point for Application. The user code starts with this function</pre></td></tr><tr><td data-num="8"></td><td><pre>  as the real entry point for the application.</pre></td></tr><tr><td data-num="9"></td><td><pre>  @param[in] ImageHandle    The firmware allocated handle for the EFI image.</pre></td></tr><tr><td data-num="10"></td><td><pre>  @param[in] SystemTable    A pointer to the EFI System Table.</pre></td></tr><tr><td data-num="11"></td><td><pre>  EFI_STATUS   typedef UINT64 UINTN;</pre></td></tr><tr><td data-num="12"></td><td><pre>  @retval EFI_SUCCESS       The entry point is executed successfully.</pre></td></tr><tr><td data-num="13"></td><td><pre>  @retval other             Some error occurs when executing this entry point.</pre></td></tr><tr><td data-num="14"></td><td><pre>**/</pre></td></tr><tr><td data-num="15"></td><td><pre>EFI_STATUS </pre></td></tr><tr><td data-num="16"></td><td><pre>EFIAPI</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">UefiMain</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  IN EFI_HANDLE        ImageHandle<span class="token punctuation">,</span>  <span class="token comment">//Image-Handle 指向模版自身加载到内存的 Image 对象，也就是 Image 对象的句柄</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  IN EFI_SYSTEM_TABLE  <span class="token operator">*</span>SystemTable  <span class="token comment">//SystemTable 是 UEFI 应用与 UEFI 内核交互的桥梁，通过它可以获得 UEFI 提供的各种服务，包括 BS 服务，和 RT 服务</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  EFI_TIME curTime<span class="token punctuation">;</span> <span class="token comment">// 时间函数结构体</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Hello,this is Entry of UefiMain!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用 Print 方法输出</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token comment">// 使用 BootService 和 RuntimeService</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  SystemTable<span class="token operator">-></span>BootServices<span class="token operator">-></span><span class="token function">Stall</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 延时 2 秒</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token comment">/*</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    调用了在 RuntimeServices 里面的 GetTime 函数指针 (&amp;curTime,NULL) 为参数</pre></td></tr><tr><td data-num="29"></td><td><pre>    RuntimeServices 为结构体</pre></td></tr><tr><td data-num="30"></td><td><pre>    将得到的时间结构体赋值给了 curTime 结构体</pre></td></tr><tr><td data-num="31"></td><td><pre>  */</pre></td></tr><tr><td data-num="32"></td><td><pre>  SystemTable<span class="token operator">-></span>RuntimeServices<span class="token operator">-></span><span class="token function">GetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curTime<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token comment">// 通过结构体输出</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Current Time: %d-%d-%d %02d:%02d:%02d\n"</span><span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Year<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Month<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Day<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Hour<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Minute<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"NanoTime:%d\n"</span><span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Nanosecond<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"TimeZone:%d\n"</span><span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>TimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Pad1:%d\n"</span><span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Pad1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Pad2:%d\n"</span><span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Pad2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token comment">// 使用 SystemTable</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token comment">// 使用 SystemTable 的输出函数调用进行输出</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  SystemTable<span class="token operator">-></span>ConOut<span class="token operator">-></span><span class="token function">OutputString</span><span class="token punctuation">(</span>SystemTable<span class="token operator">-></span>ConOut<span class="token punctuation">,</span>L<span class="token string">"Test SystemTable...\n\r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token keyword">return</span> EFI_SUCCESS<span class="token punctuation">;</span> <span class="token comment">//return 0</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="uefi_maininf"><a class="anchor" href="#uefi_maininf">#</a> Uefi_Main.inf</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>Defines<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  INF_VERSION <span class="token operator">=</span>      <span class="token number">0x00010005</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  BASE_NAME <span class="token operator">=</span>        Hello</pre></td></tr><tr><td data-num="4"></td><td><pre>  FILE_GUID <span class="token operator">=</span>        f35a7352<span class="token operator">-</span><span class="token number">2</span>cc1<span class="token operator">-</span><span class="token number">44</span>c0<span class="token operator">-</span><span class="token number">9</span>ba6<span class="token operator">-</span><span class="token number">4</span>c3b5f4dbe42</pre></td></tr><tr><td data-num="5"></td><td><pre>  MODULE_TYPE <span class="token operator">=</span>      UEFI_APPLICATION </pre></td></tr><tr><td data-num="6"></td><td><pre>  VERSION_STRING <span class="token operator">=</span>   <span class="token number">1.0</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  ENTRY_POINT <span class="token operator">=</span>      UefiMain</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>sources<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  Hello<span class="token punctuation">.</span>c</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>Packages<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  MdePkg<span class="token operator">/</span>MdePkg<span class="token punctuation">.</span>dec</pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">MdeModulePkg<span class="token operator">/</span>MdeModulePkg<span class="token punctuation">.</span>dec</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>LibraryClasses<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  UefiApplicationEntryPoint</pre></td></tr><tr><td data-num="15"></td><td><pre>  UefiLib</pre></td></tr></table></figure><h3 id="shellapp_mainc"><a class="anchor" href="#shellapp_mainc">#</a> <code>ShellApp_Main.c</code></h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">&lt;Uefi.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">&lt;Library/UefiLib.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">&lt;Library/ShellCEntryLib.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Library/UefiBootServicesTableLib.h></span>  <span class="token comment">//gST,gBs</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Library/UefiRuntimeServicesTableLib.h></span> <span class="token comment">//gRT</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">/***</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  Print a welcoming message.</pre></td></tr><tr><td data-num="8"></td><td><pre>  Establishes the main structure of the application.</pre></td></tr><tr><td data-num="9"></td><td><pre>  @retval  0         The application exited normally.</pre></td></tr><tr><td data-num="10"></td><td><pre>  @retval  Other     An error occurred.</pre></td></tr><tr><td data-num="11"></td><td><pre>***/</pre></td></tr><tr><td data-num="12"></td><td><pre>INTN</pre></td></tr><tr><td data-num="13"></td><td><pre>EFIAPI</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">ShellAppMain</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  IN UINTN Argc<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  IN CHAR16 <span class="token operator">*</span><span class="token operator">*</span>Argv</pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  EFI_TIME curTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Hello,this is Entry of ShellAppMain!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token comment">// 使用 BootService 和 RuntimeService</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token comment">//gST->BootServices->Stall (2000);  // 延时 2 秒</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  gBS<span class="token operator">-></span><span class="token function">Stall</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token comment">// gST->RuntimeServices->GetTime(&amp;curTime,NULL);</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  gRT<span class="token operator">-></span><span class="token function">GetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curTime<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Current Time: %d-%d-%d %02d:%02d:%02d\n"</span><span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Year<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Month<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Day<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Hour<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Minute<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token comment">// 使用 SystemTable</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  gST<span class="token operator">-></span>ConOut<span class="token operator">-></span><span class="token function">OutputString</span><span class="token punctuation">(</span>gST<span class="token operator">-></span>ConOut<span class="token punctuation">,</span>L<span class="token string">"Test SystemTable...\n\r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="shellapp_maininf"><a class="anchor" href="#shellapp_maininf">#</a> ShellApp_Main.inf</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>## @file</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>  <span class="token expression">Sample UEFI Application Reference EDKII Module<span class="token punctuation">.</span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>#</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>  <span class="token expression">This is a sample shell application that will print Hello<span class="token punctuation">,</span>this is Entry of ShellAppMain<span class="token operator">!</span>" to the</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>  <span class="token expression">UEFI Console<span class="token punctuation">.</span></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>#</pre></td></tr><tr><td data-num="7"></td><td><pre>##</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>Defines<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  INF_VERSION                    <span class="token operator">=</span> <span class="token number">0x00010006</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  BASE_NAME                      <span class="token operator">=</span> ShellApp_Main</pre></td></tr><tr><td data-num="12"></td><td><pre>  FILE_GUID                      <span class="token operator">=</span> a912f198<span class="token operator">-</span><span class="token number">7f</span><span class="token number">0e-4813</span><span class="token operator">-</span>b918<span class="token operator">-</span>b757b106ec83</pre></td></tr><tr><td data-num="13"></td><td><pre>  MODULE_TYPE                    <span class="token operator">=</span> UEFI_APPLICATION</pre></td></tr><tr><td data-num="14"></td><td><pre>  VERSION_STRING                 <span class="token operator">=</span> <span class="token number">0.1</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  ENTRY_POINT                    <span class="token operator">=</span> ShellCEntryLib</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>#</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>  <span class="token expression">VALID_ARCHITECTURES           <span class="token operator">=</span> IA32 X64</span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>#</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span>Sources<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  ShellApp_Main<span class="token punctuation">.</span>c</pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span>Packages<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  MdePkg<span class="token operator">/</span>MdePkg<span class="token punctuation">.</span>dec</pre></td></tr><tr><td data-num="26"></td><td><pre>  ShellPkg<span class="token operator">/</span>ShellPkg<span class="token punctuation">.</span>dec</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>LibraryClasses<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  UefiLib</pre></td></tr><tr><td data-num="30"></td><td><pre>  ShellCEntryLib</pre></td></tr></table></figure><h3 id="stdlib_mainc"><a class="anchor" href="#stdlib_mainc">#</a> <code>Stdlib_Main.c</code></h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">&lt;Uefi.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">&lt;Library/UefiLib.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">&lt;Library/ShellCEntryLib.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Library/UefiBootServicesTableLib.h></span>  <span class="token comment">//gST,gBs</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Library/UefiRuntimeServicesTableLib.h></span> <span class="token comment">//gRT</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">/***</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  Demonstrates basic workings of the main() function by displaying a</pre></td></tr><tr><td data-num="12"></td><td><pre>  welcoming message.</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>  Note that the UEFI command line is composed of 16-bit UCS2 wide characters.</pre></td></tr><tr><td data-num="15"></td><td><pre>  The easiest way to access the command line parameters is to cast Argv as:</pre></td></tr><tr><td data-num="16"></td><td><pre>  wchar_t **wArgv = (wchar_t **)Argv;</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>  @param[in]  Argc    Number of argument tokens pointed to by Argv.</pre></td></tr><tr><td data-num="19"></td><td><pre>  @param[in]  Argv    Array of Argc pointers to command line tokens.</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>  @retval  0         The application exited normally.</pre></td></tr><tr><td data-num="22"></td><td><pre>  @retval  Other     An error occurred.</pre></td></tr><tr><td data-num="23"></td><td><pre>***/</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">int</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token function">main</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  IN <span class="token keyword">int</span> Argc<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  IN <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>Argv</pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  EFI_TIME curTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Hello,this is Entry of ShellAppMain!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello,this is Entry of main!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token comment">// 使用 BootService 和 RuntimeService</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  gST<span class="token operator">-></span>BootServices<span class="token operator">-></span><span class="token function">Stall</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 延时 2 秒</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  gBS<span class="token operator">-></span><span class="token function">Stall</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用全局变量</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token comment">// 获取时间，真实的函数只有一个，而实现函数的函数指针有多个</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  gST<span class="token operator">-></span>RuntimeServices<span class="token operator">-></span><span class="token function">GetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curTime<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  gRT<span class="token operator">-></span><span class="token function">GetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curTime<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Current Time: %d-%d-%d %02d:%02d:%02d\n"</span><span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Year<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Month<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Day<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Hour<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Minute<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token comment">// 使用 SystemTable</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  gST<span class="token operator">-></span>ConOut<span class="token operator">-></span><span class="token function">OutputString</span><span class="token punctuation">(</span>gST<span class="token operator">-></span>ConOut<span class="token punctuation">,</span>L<span class="token string">"Test SystemTable...\n\r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="stdlib_maininf"><a class="anchor" href="#stdlib_maininf">#</a> Stdlib_Main.inf</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>## @file</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>  <span class="token expression">Sample UEFI Application Reference EDKII Module<span class="token punctuation">.</span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>#</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>  <span class="token expression">This is a sample shell application that will print Hello<span class="token punctuation">,</span>this is Entry of main<span class="token operator">!</span>" to the</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>  <span class="token expression">UEFI Console<span class="token punctuation">.</span></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>#</pre></td></tr><tr><td data-num="7"></td><td><pre>##</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>Defines<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  INF_VERSION                    <span class="token operator">=</span> <span class="token number">0x00010006</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  BASE_NAME                      <span class="token operator">=</span> Stdlib_Main</pre></td></tr><tr><td data-num="11"></td><td><pre>  FILE_GUID                      <span class="token operator">=</span> <span class="token number">4</span>ea97c46<span class="token operator">-</span><span class="token number">1491</span><span class="token operator">-</span><span class="token number">4</span>dfd<span class="token operator">-</span>b412<span class="token operator">-</span><span class="token number">747010f</span><span class="token number">31e5f</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  MODULE_TYPE                    <span class="token operator">=</span> UEFI_APPLICATION</pre></td></tr><tr><td data-num="13"></td><td><pre>  VERSION_STRING                 <span class="token operator">=</span> <span class="token number">0.1</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  ENTRY_POINT                    <span class="token operator">=</span> ShellCEntryLib</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>#</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span>  <span class="token expression">VALID_ARCHITECTURES           <span class="token operator">=</span> IA32 X64</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>#</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span>Sources<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  Stdlib_Main<span class="token punctuation">.</span>c</pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span>Packages<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  StdLib<span class="token operator">/</span>StdLib<span class="token punctuation">.</span>dec</pre></td></tr><tr><td data-num="25"></td><td><pre>  MdePkg<span class="token operator">/</span>MdePkg<span class="token punctuation">.</span>dec</pre></td></tr><tr><td data-num="26"></td><td><pre>  ShellPkg<span class="token operator">/</span>ShellPkg<span class="token punctuation">.</span>dec</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>LibraryClasses<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  LibC</pre></td></tr><tr><td data-num="30"></td><td><pre>  LibStdio</pre></td></tr></table></figure><h2 id="dsc添加编译"><a class="anchor" href="#dsc添加编译">#</a> DSC 添加编译</h2><blockquote><p>将添加到 <code>AppPkg</code> 目录下的文件添加到 <code>Components</code> 目录下</p></blockquote><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>Components<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  AppPkg<span class="token operator">/</span>Applications<span class="token operator">/</span>ShellApp_Main<span class="token operator">/</span>ShellApp_Main<span class="token punctuation">.</span>inf</pre></td></tr><tr><td data-num="3"></td><td><pre>  AppPkg<span class="token operator">/</span>Applications<span class="token operator">/</span>Stdlib_Main<span class="token operator">/</span>Stdlib_Main<span class="token punctuation">.</span>inf    </pre></td></tr><tr><td data-num="4"></td><td><pre>  AppPkg<span class="token operator">/</span>Applications<span class="token operator">/</span>Uefi_Main<span class="token operator">/</span>Uefi_Main<span class="token punctuation">.</span>inf</pre></td></tr></table></figure><h2 id="修改输出位置"><a class="anchor" href="#修改输出位置">#</a> 修改输出位置</h2><blockquote><p>为了 <code>方便EDK2运行环境</code> 执行，固将 <code>AppPkg.dsc</code> 输出的 <code>目录</code> 修改为 <code>EDK2</code> 编译环境的 <code>执行位置</code> ，方便 <code>测试执行</code></p><p>修改下面对应的</p></blockquote><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>Defines<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	OUTPUT_DIRECTORY               <span class="token operator">=</span> Build<span class="token operator">/</span>EmulatorX64<span class="token operator">/</span>DEBUG_VS2019<span class="token operator">/</span>X64  # 输出到指定的位置</pre></td></tr></table></figure><h2 id="edk2编译"><a class="anchor" href="#edk2编译">#</a> EDK2 编译</h2><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre># 编译mybuild<span class="token punctuation">.</span>bat</pre></td></tr><tr><td data-num="2"></td><td><pre>mybuild<span class="token punctuation">.</span>bat</pre></td></tr><tr><td data-num="3"></td><td><pre>edk2\edksetup<span class="token punctuation">.</span>bat</pre></td></tr><tr><td data-num="4"></td><td><pre># 编译edk2的UEFI模拟器</pre></td></tr><tr><td data-num="5"></td><td><pre>build <span class="token operator">-</span>p edk2\EmulatorPkg\EmulatorPkg<span class="token punctuation">.</span>dsc <span class="token operator">-</span>t VS2019 <span class="token operator">-</span>a X64</pre></td></tr><tr><td data-num="6"></td><td><pre># 编译UEFI程序</pre></td></tr><tr><td data-num="7"></td><td><pre>build <span class="token operator">-</span>p edk2<span class="token operator">-</span>libc\AppPkg\AppPkg<span class="token punctuation">.</span>dsc <span class="token operator">-</span>t VS2019 <span class="token operator">-</span>a X64</pre></td></tr><tr><td data-num="8"></td><td><pre>    </pre></td></tr><tr><td data-num="9"></td><td><pre># 清理编译结果，如果不清空，存在无法覆盖问题</pre></td></tr><tr><td data-num="10"></td><td><pre>build clean <span class="token operator">-</span>p edk2\EmulatorPkg\EmulatorPkg<span class="token punctuation">.</span>dsc <span class="token operator">-</span>t VS2019 <span class="token operator">-</span>a X64</pre></td></tr><tr><td data-num="11"></td><td><pre>    </pre></td></tr><tr><td data-num="12"></td><td><pre># 清理edk2<span class="token operator">-</span>lib2</pre></td></tr><tr><td data-num="13"></td><td><pre>build clean <span class="token operator">-</span>p edk2<span class="token operator">-</span>libc\AppPkg\AppPkg<span class="token punctuation">.</span>dsc <span class="token operator">-</span>t VS2019 <span class="token operator">-</span>a X64</pre></td></tr></table></figure><blockquote><ul><li><code>编译完成</code> 之后会 <code>创建Build目录</code></li><li>运行 <code>build</code> 即可对刚才 <code>输入的程序</code> 进行 <code>编译</code> 成 <code>efi可执行</code> 文件</li><li>进入 <code>WinHost.exe</code> 运行对应的 <code>文件名</code> 即可 <code>运行成功</code></li></ul></blockquote><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 输入如下指令，进入根目录</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FS0:</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 输入 Hello 点回车自动补全，即可进入 HelloWorld.efi 输出 UEFI Hello World!</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Hello.efi</pre></td></tr></table></figure><p><img data-src="./assets/image-20230801143734101.png" alt="第一个HelloWorld"></p><blockquote><p>运行结束后，执行 <code>build clean</code> 清空缓存，以防止 <code>再次编译无法覆盖</code> 问题。</p></blockquote><h1 id="相关指令"><a class="anchor" href="#相关指令">#</a> 相关指令</h1><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 启动 UI 的 BIOS 页面</span></pre></td></tr><tr><td data-num="2"></td><td><pre>UiApp.efi</pre></td></tr></table></figure><h1 id="编译运行"><a class="anchor" href="#编译运行">#</a> 编译运行</h1><blockquote><p>在 edk2 的跟页面启动 CMD, 运行</p></blockquote><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre>edksetup.bat</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 设置之后修改 conf 中的 target.txt</span></pre></td></tr><tr><td data-num="3"></td><td><pre>edksetup.bat rebuild </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 通过 build 构建，此方法构建的是默认 conf 设置的包路径</span></pre></td></tr><tr><td data-num="5"></td><td><pre>build</pre></td></tr></table></figure><h1 id="鼠标抓取小项目"><a class="anchor" href="#鼠标抓取小项目">#</a> 鼠标抓取小项目</h1><blockquote><p>首先将 <code>鼠标</code> 和 <code>键盘</code> 的 <code>时间绑定</code> 到 <code>events事件</code> 里</p><ul><li>通过 <code>while(1)</code> 循环</li><li>等待鼠标或键盘事件发生， <code>0</code> 为 <code>鼠标</code> ，其它为 <code>键盘</code></li><li>当为 <code>数</code> 表示时获取 <code>当前鼠标</code> 的状态，根据其状态输 <code>出其对应的位置</code> 和 <code>点击时间</code> ，输出左键或右键</li><li>键盘的话，判断其对应的是否为 <code>q</code> , 若为 <code>q</code> 将 <code>break</code> ， <code>结束循环</code></li><li>若键盘输入 <code>不为k</code> ， <code>输出</code> 其值</li></ul><p>后续可逐步进化到鼠标 <code>控制UEFI</code> 界面</p><p><code>小Bug</code> ：</p><ul><li>键盘上 <code>输入</code> 的 <code>字母</code> ，需要点一下 <code>鼠标</code> 才能显示出来。</li></ul></blockquote><h2 id="mouse_mainc"><a class="anchor" href="#mouse_mainc">#</a> <code>Mouse_Main.c</code></h2><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Uefi.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Library/UefiLib.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Library/UefiBootServicesTableLib.h></span> <span class="token comment">//gST,gBs</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Library/UefiRuntimeServicesTableLib.h></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Protocol/SimplePointer.h></span> <span class="token comment">//mouse point include Protocol</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// Include/Protocol/SimplePointer </span></pre></td></tr><tr><td data-num="8"></td><td><pre>EFI_GUID gEfiSimplePointerProtocolGuid <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0x31878C87</span><span class="token punctuation">,</span> <span class="token number">0x0B75</span><span class="token punctuation">,</span> <span class="token number">0x11D5</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token number">0x9A</span><span class="token punctuation">,</span> <span class="token number">0x4F</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0x3F</span><span class="token punctuation">,</span> <span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0x4D</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>EFI_STATUS</pre></td></tr><tr><td data-num="11"></td><td><pre>EFIAPI</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">UefiMain</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    IN EFI_HANDLE ImageHandle<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="14"></td><td><pre>    IN EFI_SYSTEM_TABLE <span class="token operator">*</span>SystemTable </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    </pre></td></tr><tr><td data-num="18"></td><td><pre>    EFI_TIME curTime<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"mouse clicked grap!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    SystemTable<span class="token operator">-></span>ConOut<span class="token operator">-></span><span class="token function">OutputString</span><span class="token punctuation">(</span>SystemTable<span class="token operator">-></span>ConOut<span class="token punctuation">,</span>L<span class="token string">"mouse clicked grap\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>   </pre></td></tr><tr><td data-num="22"></td><td><pre>    gRT<span class="token operator">-></span><span class="token function">GetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curTime<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Clicked Time: %d-%d-%d %d-%d-%d-%d\n"</span><span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Year<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Month<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Day<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Hour<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Minute<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Nanosecond<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// Enable Cursor</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>    EFI_STATUS Status<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    EFI_SIMPLE_POINTER_PROTOCOL<span class="token operator">*</span> mounse <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    EFI_SIMPLE_POINTER_STATE State<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    EFI_EVENT events<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 键盘鼠标事件</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment">// 显示光标</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    gST<span class="token operator">-></span>ConOut<span class="token operator">-></span><span class="token function">EnableCursor</span><span class="token punctuation">(</span>gST<span class="token operator">-></span>ConOut<span class="token punctuation">,</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment">// 根据 GUID 值找出鼠标设备</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    Status <span class="token operator">=</span> gBS<span class="token operator">-></span><span class="token function">LocateProtocol</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token operator">&amp;</span>gEfiSimplePointerProtocolGuid<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token constant">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token punctuation">(</span>VOID<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>mounse</pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">// 错误判断</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">EFI_ERROR</span><span class="token punctuation">(</span>Status<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Unable to initialize EFI_SIMPLE_POINTER_PROTOCOL protocol interface!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token comment">// 重置鼠标设置</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    Status <span class="token operator">=</span> mounse<span class="token operator">-></span><span class="token function">Reset</span><span class="token punctuation">(</span>mounse<span class="token punctuation">,</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token comment">// 错误判断</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">EFI_ERROR</span><span class="token punctuation">(</span>Status<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Unable to initialize EFI_SIMPLE_POINTER_PROTOCOL protocol interface!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token comment">// 将鼠标事件放到等待事件数组</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    events<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> mounse<span class="token operator">-></span>WaitForInput<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token comment">// 将键盘也放到等待数组中</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    events<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> mounse<span class="token operator">-></span>WaitForInput<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token comment">// 使用循环读取</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token comment">/* code */</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        EFI_INPUT_KEY Key<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        UINTN index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token comment">// 等待 events 中的任一事件发生，根据时间判断键盘还是鼠标</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        Status <span class="token operator">=</span> gBS<span class="token operator">-></span><span class="token function">WaitForEvent</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>events<span class="token punctuation">,</span><span class="token operator">&amp;</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token comment">// 根据 index 的不同值会传出不同的事件</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>State<span class="token punctuation">.</span>LeftButton<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="70"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>                <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Pressed Left\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>State<span class="token punctuation">.</span>RightButton<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>                <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Pressed Right\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token comment">// 获取鼠标状态并输出</span></pre></td></tr><tr><td data-num="78"></td><td><pre>            Status <span class="token operator">=</span> mounse<span class="token operator">-></span><span class="token function">GetState</span><span class="token punctuation">(</span>mounse<span class="token punctuation">,</span><span class="token operator">&amp;</span>State<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>            gRT<span class="token operator">-></span><span class="token function">GetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curTime<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>            <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Clicked Time minuter second  N-Second:%d - %d - %d\t"</span><span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Minute<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>curTime<span class="token punctuation">.</span>Nanosecond<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>            <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"X:%d Y:%d Z:%d L:%d R:%d\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="82"></td><td><pre>            State<span class="token punctuation">.</span>RelativeMovementX<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="83"></td><td><pre>            State<span class="token punctuation">.</span>RelativeMovementY<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="84"></td><td><pre>            State<span class="token punctuation">.</span>RelativeMovementZ<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="87"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>            <span class="token comment">// 按键盘事件发生后读取键盘</span></pre></td></tr><tr><td data-num="89"></td><td><pre>            Status <span class="token operator">=</span> gST<span class="token operator">-></span>ConIn<span class="token operator">-></span><span class="token function">ReadKeyStroke</span><span class="token punctuation">(</span>gST<span class="token operator">-></span>ConIn<span class="token punctuation">,</span><span class="token operator">&amp;</span>Key<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token comment">// 错误判断</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">EFI_ERROR</span><span class="token punctuation">(</span>Status<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="92"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>                <span class="token comment">// Print (L"95 Read Key Stroke Error\n"); // 莫名多输入</span></pre></td></tr><tr><td data-num="94"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>            <span class="token comment">// 按 q 键退出</span></pre></td></tr><tr><td data-num="96"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>Key<span class="token punctuation">.</span>UnicodeChar <span class="token operator">==</span> <span class="token char">'q'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="97"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>                </pre></td></tr><tr><td data-num="99"></td><td><pre>                <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Key Board %c Was Pressed\n"</span><span class="token punctuation">,</span>Key<span class="token punctuation">.</span>UnicodeChar<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>                <span class="token comment">// SystemTable->ConOut->OutputString(SystemTable->ConOut,L"Key input:%s\n",Key.UnicodeChar);</span></pre></td></tr><tr><td data-num="101"></td><td><pre>                <span class="token comment">// Print(L"Key input:%s\n",Key.UnicodeChar);</span></pre></td></tr><tr><td data-num="102"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Key<span class="token punctuation">.</span>UnicodeChar<span class="token punctuation">)</span> <span class="token comment">// 当键盘有数据输入时，对其进行输入，若没有不操作</span></pre></td></tr><tr><td data-num="105"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>                <span class="token function">Print</span><span class="token punctuation">(</span>L<span class="token string">"Key Board %c Was Pressed\n"</span><span class="token punctuation">,</span>Key<span class="token punctuation">.</span>UnicodeChar<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="109"></td><td><pre></pre></td></tr><tr><td data-num="110"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>    <span class="token keyword">return</span> EFI_SUCCESS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="mouse_maininf"><a class="anchor" href="#mouse_maininf">#</a> Mouse_Main.inf</h2><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>Defines<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    INF_VERSION <span class="token operator">=</span> <span class="token number">0x00010007</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    BASE_NAME <span class="token operator">=</span> Mouse_Main </pre></td></tr><tr><td data-num="4"></td><td><pre>    FILE_GUID <span class="token operator">=</span> b579648b<span class="token operator">-</span><span class="token number">5331</span><span class="token operator">-</span><span class="token number">46</span>a4<span class="token operator">-</span><span class="token number">93</span>ce<span class="token operator">-</span><span class="token number">22423e567f</span><span class="token number">55</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    VERSION_STRING <span class="token operator">=</span> <span class="token number">0.1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    MODULE_TYPE <span class="token operator">=</span> UEFI_APPLICATION</pre></td></tr><tr><td data-num="7"></td><td><pre>    ENTRY_POINT <span class="token operator">=</span> UefiMain</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>Sources<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    Mouse_Main<span class="token punctuation">.</span>c </pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>Packages<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    MdePkg<span class="token operator">/</span>MdePkg<span class="token punctuation">.</span>dec</pre></td></tr><tr><td data-num="15"></td><td><pre>    MdeModulePkg<span class="token operator">/</span>MdeModulePkg<span class="token punctuation">.</span>dec</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>LibraryClasses<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    UefiApplicationEntryPoint</pre></td></tr><tr><td data-num="19"></td><td><pre>    UefiLib</pre></td></tr></table></figure><h1 id="应用程序加载过程"><a class="anchor" href="#应用程序加载过程">#</a> 应用程序加载过程</h1><blockquote><p>一个 <code>应用程序</code> 被编译成 <code>.efi</code> 文件，整体上分成 <code>三步</code></p></blockquote><ul><li><code>UefiMain.c</code> 被编译成目标文件 <code>UefiMain.obj</code> (程序编译后的二进制代码)</li><li>连接器将目标文件 <code>UefiMain.obj</code> 和 <code>其他库</code> 连接成 <code>UefiMain.dll</code> ( <code>Dynamic Link LIbrary``动态链接库</code> )</li><li><code>GenFW工具</code> 将 <code>UefiMain.dl</code> 转换成 <code>UefiMain.efi</code></li></ul><p><img data-src="./assets/image-20230803104407974.png" alt="UEFI编译过程"></p><h1 id="报错解决思路"><a class="anchor" href="#报错解决思路">#</a> 报错解决思路</h1><h2 id="问题error-7000"><a class="anchor" href="#问题error-7000">#</a> 问题 error 7000</h2><blockquote><p>error 7000: Failed to execute command Vc\bin\nmake.exe /nologo tbuild</p></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbvthkUaBMX9zWiccSLd09Nd75nJ6Eaxx25xEZHibO9FobrLbbROUqvCYbribvRianv4wKaTTP8OmgE8rg/640?wx_fmt=png" alt="error 7000"></p><h2 id="解决"><a class="anchor" href="#解决">#</a> 解决</h2><blockquote><p>通过 <code>UltraEdit</code> 查看 <code>中文注释</code> 是否存在 <code>乱码</code> 等行为.</p><p>解决乱码就 OK 啦，本身使用 VS Code 输入的莫名乱码，查 Bug 查了好久。</p></blockquote><h2 id="file-read-failture"><a class="anchor" href="#file-read-failture">#</a> <code>file read failture</code></h2><blockquote><p>inf 模版工程文件不可有中文，包括 <code>注释</code> ， <code>中文会报错</code></p></blockquote><h2 id="注意性报错"><a class="anchor" href="#注意性报错">#</a> 注意性报错</h2><blockquote><p>在 <code>输出</code> 的 <code>字符串</code> 要加上 <code>L</code></p></blockquote><h2 id="fatal-error-lnk1120"><a class="anchor" href="#fatal-error-lnk1120">#</a> fatal error <code>LNK1120</code></h2><blockquote><p><code>链接失败</code> ，可能为在引用 <code>GUID地址</code> 时， <code>没有</code> 在 <code>当前函数</code> 对其进行 <code>赋值</code></p><p>在引用 <code>gEfiSimplePointerProtocolGuid</code> 是在 <code>文件顶部</code> 添加其 <code>对应的GUID</code> 唯一编码。</p></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbvthkUaBMX9zWiccSLd09Nd74icjplkqKjnZIbB94gsPPehVV4NQMLc3yrawHOYW2fDygqsnTia6OOSg/640?wx_fmt=png" alt="链接GUID"></p><div class="tags"><a href="/tags/BIOS/" rel="tag"><i class="ic i-tag"></i>BIOS</a><a href="/tags/UEFI/" rel="tag"><i class="ic i-tag"></i>UEFI</a><a href="/tags/EDK2/" rel="tag"><i class="ic i-tag"></i>EDK2</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="BIOS/EDK2入口函数/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2023-08-14 23:18:37" itemprop="dateModified" datetime="2023-08-14T23:18:37+08:00">2023-08-14</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/assets/wechatpay.png" alt="YuHeShui 微信支付"><p>微信支付</p></div><div><img data-src="/assets/alipay.png" alt="YuHeShui 支付宝"><p>支付宝</p></div><div><img data-src="/assets/paypal.png" alt="YuHeShui 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>YuHeShui<i class="ic i-at"><em>@</em></i>瓶子的跋涉</li><li class="link"><strong>本文链接：</strong><a href="https://www.blog.foryouos.cn/BIOS/EDK2%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0/" title="EDK2入口函数">https://www.blog.foryouos.cn/BIOS/EDK2入口函数/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/BIOS/C%E6%8C%87%E9%92%88%E6%93%8D%E4%BD%9C%E5%AF%84%E5%AD%98%E5%99%A8/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;mmbiz.qpic.cn&#x2F;mmbiz_jpg&#x2F;ORog4TEnkbuJR35j0ovVEObhXT1NiaKTsCGXD87Zl68xiagTLcQSeGEoxk3sNO0ic9tXNKLiajtZdpl6mF8JJ8Rqdw&#x2F;640?wx_fmt&#x3D;jpeg" title="C指针与操作寄存器方法"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>BIOS</span><h3>C指针与操作寄存器方法</h3></a></div><div class="item right"><a href="/BIOS/BIOS%E5%B7%A5%E7%A8%8B%E6%A8%A1%E5%9D%97UEFI/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;mmbiz.qpic.cn&#x2F;mmbiz_jpg&#x2F;ORog4TEnkbvthkUaBMX9zWiccSLd09Nd7eibo4PKxaAlnuDZ1ibBXhoBFwyg1uHsfYmeNDRlbnSm2Uiafn2eGswX0g&#x2F;640?wx_fmt&#x3D;jpeg" title="BIOS工程模块UEFI"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>BIOS</span><h3>BIOS工程模块UEFI</h3></a></div></div><div class="wrap" id="wcomments"></div><script type="module" data-pjax="data-pjax">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';

setTimeout(function () {
    init({
        el: '#wcomments',
        serverURL: 'https://foryouos.netlify.app/.netlify/functions/comment',
        lang: 'zh-CN',
        locale: {},
        emoji: ["https://unpkg.com/@waline/emojis@1.0.1/weibo","https://unpkg.com/@waline/emojis@1.0.1/alus","https://unpkg.com/@waline/emojis@1.0.1/bilibili","https://unpkg.com/@waline/emojis@1.0.1/qq","https://unpkg.com/@waline/emojis@1.0.1/tieba","https://unpkg.com/@waline/emojis@1.0.1/tw-emoji"],
        meta: ["nick","mail","link"],
        requiredMeta: ["nick","mail"],
        wordLimit: 0,
        pageSize: 10,
        pageview: true,
        path: window.location.pathname,
        dark: 'html[data-theme="dark"]'
    });
}, 1000)</script></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">入口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E7%B1%BB%E5%9E%8Befi_status"><span class="toc-number">1.1.</span> <span class="toc-text">入口函数返回值类型 EFI_STATUS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.</span> <span class="toc-text">头文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#efi%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">efi 文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#guid"><span class="toc-number">2.1.</span> <span class="toc-text">GUID</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%87%8F"><span class="toc-number">3.</span> <span class="toc-text">字符量</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84"><span class="toc-number">4.</span> <span class="toc-text">工程结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8edk2"><span class="toc-number">5.</span> <span class="toc-text">启动 EDK2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AAhello-word"><span class="toc-number">6.</span> <span class="toc-text">第一个 Hello Word</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%86%85%E5%AE%B9"><span class="toc-number">6.1.</span> <span class="toc-text">存储内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0-2"><span class="toc-number">6.2.</span> <span class="toc-text">入口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#uefi_mainc"><span class="toc-number">6.2.1.</span> <span class="toc-text">Uefi_Main.c</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uefi_maininf"><span class="toc-number">6.2.2.</span> <span class="toc-text">Uefi_Main.inf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shellapp_mainc"><span class="toc-number">6.2.3.</span> <span class="toc-text">ShellApp_Main.c</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shellapp_maininf"><span class="toc-number">6.2.4.</span> <span class="toc-text">ShellApp_Main.inf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stdlib_mainc"><span class="toc-number">6.2.5.</span> <span class="toc-text">Stdlib_Main.c</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stdlib_maininf"><span class="toc-number">6.2.6.</span> <span class="toc-text">Stdlib_Main.inf</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dsc%E6%B7%BB%E5%8A%A0%E7%BC%96%E8%AF%91"><span class="toc-number">6.3.</span> <span class="toc-text">DSC 添加编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%BE%93%E5%87%BA%E4%BD%8D%E7%BD%AE"><span class="toc-number">6.4.</span> <span class="toc-text">修改输出位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#edk2%E7%BC%96%E8%AF%91"><span class="toc-number">6.5.</span> <span class="toc-text">EDK2 编译</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="toc-number">7.</span> <span class="toc-text">相关指令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C"><span class="toc-number">8.</span> <span class="toc-text">编译运行</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E6%8A%93%E5%8F%96%E5%B0%8F%E9%A1%B9%E7%9B%AE"><span class="toc-number">9.</span> <span class="toc-text">鼠标抓取小项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mouse_mainc"><span class="toc-number">9.1.</span> <span class="toc-text">Mouse_Main.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mouse_maininf"><span class="toc-number">9.2.</span> <span class="toc-text">Mouse_Main.inf</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number">10.</span> <span class="toc-text">应用程序加载过程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF"><span class="toc-number">11.</span> <span class="toc-text">报错解决思路</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98error-7000"><span class="toc-number">11.1.</span> <span class="toc-text">问题 error 7000</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3"><span class="toc-number">11.2.</span> <span class="toc-text">解决</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#file-read-failture"><span class="toc-number">11.3.</span> <span class="toc-text">file read failture</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E6%80%A7%E6%8A%A5%E9%94%99"><span class="toc-number">11.4.</span> <span class="toc-text">注意性报错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fatal-error-lnk1120"><span class="toc-number">11.5.</span> <span class="toc-text">fatal error LNK1120</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/BIOS/BIOS%E4%B8%8E%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8/" rel="bookmark" title="BIOS与系统启动">BIOS与系统启动</a></li><li><a href="/BIOS/EDK2%E4%B8%8E%E5%8F%8C%E7%B3%BB%E7%BB%9F/" rel="bookmark" title="EDK2安装与双系统">EDK2安装与双系统</a></li><li><a href="/BIOS/UEFI%E4%B8%83%E9%98%B6%E6%AE%B5/" rel="bookmark" title="UEFI概述">UEFI概述</a></li><li><a href="/BIOS/C%E6%8C%87%E9%92%88%E6%93%8D%E4%BD%9C%E5%AF%84%E5%AD%98%E5%99%A8/" rel="bookmark" title="C指针与操作寄存器方法">C指针与操作寄存器方法</a></li><li class="active"><a href="/BIOS/EDK2%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0/" rel="bookmark" title="EDK2入口函数">EDK2入口函数</a></li><li><a href="/BIOS/BIOS%E5%B7%A5%E7%A8%8B%E6%A8%A1%E5%9D%97UEFI/" rel="bookmark" title="BIOS工程模块UEFI">BIOS工程模块UEFI</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="YuHeShui" data-src="/assets/avatar.jpg"><p class="name" itemprop="name">YuHeShui</p><div class="description" itemprop="description">瓶子的跋涉 & 编程笔记</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">67</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">37</span><span class="name">标签</span></a></div></nav><div class="social"><a href="https://github.com/foryouos" class="item github" rel="noopener external nofollow noreferrer" title="https:&#x2F;&#x2F;github.com&#x2F;foryouos" target="_blank"><i class="ic i-github"></i></a><a href="https://www.zhihu.com/people/foryouos" class="item zhihu" rel="noopener external nofollow noreferrer" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;foryouos" target="_blank"><i class="ic i-zhihu"></i></a><a href="mailto:foryouos@mail.com" class="item email" rel="noopener external nofollow noreferrer" title="mailto:foryouos@mail.com" target="_blank"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);" rel="external nofollow noreferrer"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);" rel="external nofollow noreferrer"><i class="ic i-user"></i>外链</a><ul class="submenu"><li class="item"><a href="https://www.foryouos.cn/" rel="noopener external nofollow noreferrer" target="_blank"><i class="ic i-user"></i>主页</a></li><li class="item"><a href="https://www.so.foryouos.cn/" rel="noopener external nofollow noreferrer" target="_blank"><i class="ic i-magic"></i>搜索</a></li><li class="item"><a href="https://imgtg.com/foryouos" rel="noopener external nofollow noreferrer" target="_blank"><i class="ic i-coffee"></i>图库</a></li></ul></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/BIOS/BIOS%E5%B7%A5%E7%A8%8B%E6%A8%A1%E5%9D%97UEFI/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/BIOS/C%E6%8C%87%E9%92%88%E6%93%8D%E4%BD%9C%E5%AF%84%E5%AD%98%E5%99%A8/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/" title="分类于C++">C++</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/course-1/" title="分类于郑莉老师C++语言程序设计">郑莉老师C++语言程序设计</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/cpp/course-1/cpp%E6%B3%9B%E5%8C%96%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">C++泛化程序设计</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Certificate/" title="分类于考证">考证</a><i class="ic i-angle-right"></i><a href="/categories/Certificate/soft/" title="分类于软件">软件</a><i class="ic i-angle-right"></i><a href="/categories/Certificate/soft/work/" title="分类于工作">工作</a><i class="ic i-angle-right"></i></div><span><a href="/Certificate/soft/work/STL%E5%BC%BA%E5%8C%96/">STL强化</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/Linux/" title="分类于Linux">Linux</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/Linux/linux%E5%85%A5%E9%97%A82/">linux入门2</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/" title="分类于C++">C++</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/course-5/" title="分类于Qt">Qt</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/cpp/course-5/Qt%E5%AE%9E%E7%8E%B0%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1/">Qt实现串口通信</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/" title="分类于C++">C++</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/course-2/" title="分类于汇编与STl新特征">汇编与STl新特征</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/cpp/course-2/STL%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/">STL顺序容器</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/" title="分类于C++">C++</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/course-2/" title="分类于汇编与STl新特征">汇编与STl新特征</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/cpp/course-2/%E6%8E%92%E5%BA%8F/">排序算法C++</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/web/" title="分类于web">web</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/web/front/" title="分类于前端">前端</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/web/front/Myweb/">我的网站</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/" title="分类于C++">C++</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/course-2/" title="分类于汇编与STl新特征">汇编与STl新特征</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/cpp/course-2/STL%E5%AE%B9%E5%99%A8%E9%80%82%E9%85%8D%E5%99%A8/">STL容器适配器</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Certificate/" title="分类于考证">考证</a><i class="ic i-angle-right"></i><a href="/categories/Certificate/soft/" title="分类于软件">软件</a><i class="ic i-angle-right"></i><a href="/categories/Certificate/soft/work/" title="分类于工作">工作</a><i class="ic i-angle-right"></i></div><span><a href="/Certificate/soft/work/%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2/">进制转换</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/" title="分类于C++">C++</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/course-1/" title="分类于郑莉老师C++语言程序设计">郑莉老师C++语言程序设计</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/cpp/course-1/cpp%E6%B5%81%E7%A8%8B%E5%BA%93%E8%BE%93%E5%85%A5%E4%B8%8E%E8%BE%93%E5%87%BA/">C++流程库输入与输出</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"><li class="item" v-for="com in coms"><a v-bind:href="root + com.href" data-pjax-state="data-pjax-state"><span class="breadcrumb">{{com.nick}} @ {{com.time}}</span><span>{{com.text}}<br></span></a></li></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2023</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">YuHeShui @ foryouos</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">745k 字</span><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">11:17</span></div><div class="powered-by">基于 <a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> & Theme.<a href="https://github.com/theme-shoka-x/hexo-theme-shokaX/" rel="noopener external nofollow noreferrer" target="_blank">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"BIOS/EDK2入口函数/",favicon:{show:"不负韶华",hide:"以梦为马！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,chart:!1,copy_tex:!1,katex:!1,mermaid:!1,audio:"",fancybox:!0,nocopy:!1,outime:!0,template:"&lt;div class=&quot;note warning&quot;&gt;&lt;p&gt;&lt;span class=&quot;label warning&quot;&gt;文章时效性提示&lt;/span&gt;&lt;br&gt;这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。&lt;/p&gt;&lt;/div&gt;",quiz:{choice:"单选题",multiple:"多选题",true_false:"判断题",essay:"问答题",gap_fill:"填空题",mistake:"错题备注"},ignores:[t=>t.includes("#"),t=>new RegExp(LOCAL.path+"$").test(t),[]]}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=default,fetch"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.0.2/pace.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/instantsearch.js/4.39.0/instantsearch.production.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/quicklink/2.2.0/quicklink.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/??jquery/3.5.1/jquery.min.js,fancybox/3.5.7/jquery.fancybox.min.js,justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" async></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/KaTeX/0.12.0/contrib/copy-tex.min.js" async></script><script src="https://unpkg.com/theme-shokax-pjax@latest/pjax.shokax.min.js"></script><script src="https://unpkg.com/theme-shokax-anime@latest/anime.shokax.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/lozad.js/1.16.0/lozad.min.js"></script><script src="https://unpkg.com/frappe-charts@1.5.0/dist/frappe-charts.min.iife.js"></script><script src="/js/app.js?v=0.3.3"></script><script data-pjax="data-pjax">var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?e3ba29befb93fdf32bbc553d0e5bee92",e.async=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><script type="module" data-pjax>let items = []
        import { RecentComments } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs'
        RecentComments({
          serverURL: 'https://foryouos.netlify.app/.netlify/functions/comment',
          count: 10,
        }).then(({ comments }) => {
          comments.forEach(function (item) {
              let cText = (item.orig.length > 50) ? item.orig.substring(0,50)+'...' : item.orig
              item.url = item.url !== '/' ?  '/' + item.url : item.url;
              const siteLink = item.url + "#" + item.objectId
              items.push({
                  href: siteLink,
                  nick: item.nick,
                  time: item.insertedAt.split('T').shift(),
                  text: cText
              })
          })
          Vue.createApp({
            data() {
                return {
                    coms: items,
                    root: ''
                }
            }
          }).mount('#new-comment')
        }).catch(function (err) {
          console.error(err)
        })</script></body></html><!-- rebuild by hexo-renderer-multi-next-markdown-it -->