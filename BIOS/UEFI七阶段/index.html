<!-- build time: Sun Aug 06 2023 16:23:35 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><meta name="baidu-site-verification" content="codeva-yIAXMzOV6I"><meta name="referrer" content="never"><link rel="alternate" href="/rss.xml" title="瓶子的跋涉" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="瓶子的跋涉" type="application/atom+xml"><link rel="alternate" type="application/json" title="瓶子的跋涉" href="https://www.blog.foryouos.cn/feed.json"><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.3.3"><script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.js"></script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><meta name="keywords" content="BIOS,"><link rel="canonical" href="https://www.blog.foryouos.cn/BIOS/UEFI%E4%B8%83%E9%98%B6%E6%AE%B5/"><title>UEFI概述</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">UEFI概述</h1><div class="meta"><span class="item" title="创建时间：2023-07-29 07:50:00"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2023-07-29T07:50:00+08:00">2023-07-29</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>15k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>13 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">foryouos</a></li></ul><ul class="right" id="rightNav"><li class="item theme" @click="changeThemeByBtn"><i class="ic" :class="{'i-sun': !themeStatus,'i-moon': themeStatus}"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://i.imgtg.com/2023/07/29/OimhvU.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/BIOS/" itemprop="item" rel="index" title="分类于BIOS"><span itemprop="name">BIOS<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.blog.foryouos.cn/BIOS/UEFI%E4%B8%83%E9%98%B6%E6%AE%B5/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"><meta itemprop="name" content="YuHeShui"><meta itemprop="description" content="YuHeShui, 瓶子的跋涉 &amp; 编程笔记"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="瓶子的跋涉"></span><div class="body md" itemprop="articleBody"><h1 id="bios阶段划分"><a class="anchor" href="#bios阶段划分">#</a> BIOS 阶段划分</h1><ul><li><code>SEC</code> : <code>Security</code> (安全) ： 处理 <code>平台重</code> 事件，创造一个 <code>临时的内存</code> 区 (此时内存还 <code>未初始化</code> )，在系统中作为一个可信的 root，传递信息到 <code>PEI</code></li><li><code>PEI</code> : <code>pre-efi initialization</code> (预 EFI 初始化)： <code>初始化</code> 一些 <code>永久的内存</code> HOBS ( <code>hand-off BLocks</code> ) 中内存，以及在 HOBS 里面的 <code>FV</code> (firmware volume) 位置，传递 <code>控制权到DXE</code> 阶段</li><li><code>DXE</code> ： <code>driver execution environment</code> (驱动程序执行环境) ： <code>重点</code> 关注，服务器上 <code>硬件驱动的执行环境</code> ，与 <code>后期外设</code> 的使用，有极大的关系</li><li><code>BDS</code> : <code>boot device select</code> (引导设备选择) 初始化 <code>console设备</code> ；加载设备驱动；尝试 <code>加载和执行启动项</code> 。</li><li><code>RT</code> ： <code>run time service</code> (运行时服务) ：此时与 <code>bootloader</code> 关系 <code>紧密</code></li><li><code>AL</code> : <code>after life</code> ( <code>transition from the os back to the environment</code> ) <code>of system</code></li></ul><h1 id="与bmc通信"><a class="anchor" href="#与bmc通信">#</a> 与 <code>BMC</code> 通信</h1><h2 id="基础了解"><a class="anchor" href="#基础了解">#</a> 基础了解</h2><h3 id="平台管理"><a class="anchor" href="#平台管理">#</a> 平台管理</h3><blockquote><ul><li>平台管理 ( <code>platform managemet)</code> : 平台管理表示一系列的 <code>监视</code> 和 <code>控制</code> 功能， <code>操作的对象</code> 是 <code>系统硬件</code> ，比如监视系统的 <code>温度</code> ， <code>电压</code> ， <code>风扇</code> ， <code>电源</code> 等，并 <code>做响应的</code> 调节工作，以保证系统处于 <code>健康状态</code> 。若系统 <code>不正常</code> ，通过 <code>复位方式</code> 重启</li></ul><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbsMGpxMLgwLn51xNGAJSW4OMUhm6pnFLFAPjsvVVm3UKhoDSdAID9LRzP3lntShJrRflt8mP4FkmQ/640?wx_fmt=png" alt="平台管理"></p><ul><li><p><code>BMC</code> : <code>Baseboard Management Controller)</code> ： 把上面的功能集成到一个 <code>控制器</code> 上，称为 <code>基板管理控制器</code> ， <code>BMC</code> 是一个独立的系统，它不依赖系统上的 <code>其它硬件</code> (如 <code>CPU</code> , <code>内存</code> )，也不依赖于 <code>BIOS</code> , <code>OS</code> 等，但 <code>BMC</code> 可以与 <code>BIOS</code> 和 <code>OS</code> 交互。BMC 本身也是一个 <code>带外处理器</code> (一般都是 ARM 处理器) 的小系统，单独用来处理某些工作，其中重点还是平台管理</p></li><li><p><code>BMC</code> 通过不同的 <code>接口</code> 与 <code>系统</code> 中其它 <code>组件连接</code> ， <code>LPC</code> ， <code>I2C</code> , <code>SMBUS</code> , <code>Serial</code> 等 <code>基本接口</code></p></li><li><p><code>IPMI</code> , 它是与 <code>BMC</code> 匹配的 <code>接口</code> ，所有 <code>BMC</code> 都需要实现这种接口</p></li></ul></blockquote><h3 id="ipmi"><a class="anchor" href="#ipmi">#</a> <code>IPMI</code></h3><blockquote><p><code>IPMI</code> 全称 <code>Intelligent Platform Management Interface</code> 智能平台 <code>管理接口</code> ， <code>IPM</code> 是对 <code>平台管理</code> 概念的 <code>具体规范</code> ，该规范定义了 <code>平台管理</code> 的软硬件架构， <code>交互指令</code> ， <code>事件格式</code> ， <code>数据记录</code> ， <code>能力集</code> 等，而 <code>BMC</code> 是 <code>IPMI</code> 中的一个 <code>核心</code> 部分，属于 <code>IPMI</code> 硬件架构。</p></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbsMGpxMLgwLn51xNGAJSW4OsVpI6yqBYMPjtGBDqeib1icQ3VLf070vrib6YSor4RgZ9vldlLDQAQUCA/640?wx_fmt=png" alt="IPMI智能平台管理接口"></p><h2 id="bios通信"><a class="anchor" href="#bios通信">#</a> BIOS 通信</h2><blockquote><p><code>BIOS</code> 与 <code>BMC</code> 之间的通信，主要使用 <code>IPMI</code> 。共有 <code>两个</code> 阶段 <code>PEI</code> 和 <code>DXE</code> (包括 <code>DXE</code> 后面的)，用的是不同的 <code>IPMI</code> 函数 (重点 <code>注意</code> )</p><p>虽然后使用 <code>IPMI</code> ，但使用 <code>两个</code> 通道分别是 <code>KCS</code> ， <code>BT</code> ，一般 <code>使用KCS</code> 通道。</p><p><code>BMC不会</code> 主动与 BIOS 通信，BIOS 会发送 <code>IPMI命</code> 令给 <code>BMC</code> , <code>BMC</code> 如果 <code>成功接收</code> 的话，就会有个 <code>返回信息</code> 给 <code>BIOS</code> 。</p></blockquote><h2 id="如果bmc与bios产生了通信故障"><a class="anchor" href="#如果bmc与bios产生了通信故障">#</a> 如果 <code>BMC</code> 与 <code>BIOS</code> 产生了通信故障</h2><ul><li>确认 <code>BIOS</code> 是否发送了 <code>IPMI命令</code> 给 <code>BMC</code> , 可以查看 <code>BMC</code> 返回的 <code>completion code</code> ;</li><li>确认 <code>BMC</code> 是否收到了 <code>BIOS</code> 发送的 <code>IPMI命令</code></li><li>如果 <code>BIOS</code> 发送了 <code>IPMI命令</code> ，但是 <code>BMC未接收</code> ：可能是 <code>BMC</code> 的 <code>IPMI进程</code> 正处于 <code>忙碌状态</code> ，所以 <code>丢掉</code> 了这条 <code>IPMI命</code> 令 (BIOS 如果发送失败，可以 <code>尝试多次</code> 发送；另外可以 <code>稍微调高KCS通道</code> 的 <code>延时</code> )；当然，也有可能是 BMC 的 <code>IPMI进程</code> 挂了</li><li>（极少见) <code>一条IPMI</code> 命令通常设计 <code>2个底层</code> 实现函数， <code>SendDataToBmcPort()</code> 和 <code>ReceiveBmcDataFormPort()</code> 。接收时，BIOS 从 <code>KCS</code> 的 <code>I/O端口</code> 读取 <code>数据</code> ，读完后，会 <code>检测KCS寄存器</code> 中 <code>OBF状态寄存器</code> ，如果 <code>BMC没有写</code> 数据，就会 <code>计数-1</code> ， <code>延时5ms</code> ，然后重试，当 <code>BMC</code> 一直不写数据时， <code>计数到0</code> , 就认为 <code>BMC有故障</code> ，返回 <code>Device Error</code> ;</li></ul><h1 id="acpi"><a class="anchor" href="#acpi">#</a> <code>ACPI</code></h1><blockquote><p><code>Advanced Configuration and Power Interface</code> 简称 <code>ACPI</code> ， <code>高级配置</code> 与 <code>电源接口</code> ，提供操作系统应用程序管理所有电源管理接口。</p><p>对于 BIOS 而言， <code>ACPI</code> 最直观的就是 <code>电源功耗</code> ，从而 <code>影响CPU性能</code> ，</p></blockquote><h1 id="os-loader"><a class="anchor" href="#os-loader">#</a> <code>OS Loader</code></h1><blockquote><p>操作系统加载器： <code>引导</code> 加载 <code>程序</code></p><p><code>OS loader</code> 可以通过 <code>BS(Boot Services)</code> 和 <code>RT</code> 使用 <code>UEFI</code> 提供的服务，并且将 <code>计算机的资源</code> 转移到 <code>自己手</code> 中，此过程称为 <code>TSL(Transient System Loader)</code> 。在此阶段结束之后， <code>OS Loader</code> 会调用 <code>ExitBootServices()函数</code> ，结束 <code>BS</code> 并且 <code>回收BS占用的资</code> 源，然后 <code>BIOS</code> 会进入 <code>RT阶段</code> ，然后 <code>OS loader</code> 会加载 <code>操作系统内核</code> ，逐渐进入 OS，此过程称为 <code>TSL</code> ( <code>Transient System Load</code> )</p><p>在 <code>BDS</code> 阶段， <code>BIOS</code> 会选择 <code>可启动项</code> ，按照 <code>设置的顺序</code> ， <code>逐一</code> 尝试，经过 <code>校验之后</code> ，加载 <code>OS Loader</code></p><p><code>BIOS</code> （ <code>BDS</code> 阶段）----&gt; <code>OS Loader</code> ----&gt; <code>OS</code></p><p>引导区位于 <code>FAT32</code> 格式分区。一般 FAT32 位于磁盘的最开始，大小 1MB 左右。</p><ul><li><p>UEFI 会把 <code>FAT32的格式</code> 都当做启动磁盘都添加到 <code>启动菜单</code> 中</p></li><li><p>在启动盘 <code>UEFI/Boot/BootX64.efi</code> 中加载</p></li></ul><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 硬盘启动盘文件也都位于此</span></pre></td></tr><tr><td data-num="2"></td><td><pre>EFI/Boot/BootX64.efi</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 32 位系统无需 + X64</span></pre></td></tr></table></figure></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbuvDicPdvq9q8kCkj2w7H9wbJZbSCnZZcz7drtiaLW3VLw6APLdX3VNolxKHjNtWPZkcj5yu733vicDw/640?wx_fmt=png" alt="系统启动编译结构"></p><p><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ORog4TEnkbuvDicPdvq9q8kCkj2w7H9wbVibicxxJmxzwcF0zuGlx1TutHicMCUugBNIJyia7zFCWb8ArG50v2oYHRg/640?wx_fmt=jpeg" alt="系统内核加载架构"></p><p><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ORog4TEnkbuvDicPdvq9q8kCkj2w7H9wb53vgx79GQcOuszIicGdYR2Ulh6aqBeRQicM95Vw6VH0s7oDicLsSmn2gg/640?wx_fmt=jpeg" alt="USB重装系统过程"></p><h1 id="uefi"><a class="anchor" href="#uefi">#</a> UEFI</h1><blockquote><p><code>UEFI</code> ( <code>Unified Extensible Firmware Interface</code> , 统一可扩展固件接口) 提供给 <code>操作系统</code> 的接口包括 <code>启动服务</code> ( <code>Boot Service</code> ， <code>BS</code> ) 和 <code>运行时</code> 服务 ( <code>Runtime Service</code> , <code>RT</code> ) 以及 <code>隐藏</code> 在 <code>BS之后</code> 的丰富的 <code>Protocol</code> （协议)， <code>BS</code> 和 <code>RT</code> 以 <code>表</code> 的形式 (C 语言中的 <code>结构体</code> ) 存在。</p><p>UEFI 的实现分为两部分</p><ul><li><code>平台初始化</code></li><li><code>固件</code> - 操作系统 <code>接口</code></li></ul></blockquote><h1 id="组成"><a class="anchor" href="#组成">#</a> 组成</h1><blockquote><p><code>OS Loader</code> 可以通过 <code>BS</code> 和 <code>RT</code> 使用 <code>UEFI</code> 提供的服务，将计算机资源逐渐转移到自己手中，这个过程为 <code>TSL</code> (Transient System Load)</p></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbuvDicPdvq9q8kCkj2w7H9wbQDjicdnNibvDIr9Mo7bib7863bbV6ANP87yzsSl29G7uTptDs5kjtZoMg/640?wx_fmt=png" alt="UEFi系统组成"></p><blockquote><p>当 <code>OS Loader</code> 完全 <code>掌握</code> 了计算机资源时， <code>BS</code> 也就 <code>完成</code> 了它的 <code>使命</code> 。 <code>OS Loader</code> 调用 <code>ExitBootServices()</code> 结束 <code>BS</code> 并 <code>回收BS</code> 占用的资源，之后计算机系统进入 <code>UEFI Runtime</code> 阶段</p></blockquote><h2 id="bs提供的服务tsl阶段"><a class="anchor" href="#bs提供的服务tsl阶段">#</a> BS 提供的服务 (TSL 阶段)</h2><blockquote><p><code>UEFI</code> 提供给操作系统的 <code>接口</code> ，包括 <code>启动服务</code> ( <code>Boot Services</code> , <code>BS</code> )</p></blockquote><ul><li><code>事件</code> 服务：事件时 <code>异步</code> 操作的基础，有了 <code>事件</code> 的支持，才能够在 <code>UEFI系统内</code> 执行 <code>并发操作</code></li><li><code>内存</code> 管理：提供内存的分配与释放，管理系统内存映射</li><li><code>Protocol</code> 管理：提供了 <code>安装与卸载</code> Protocol 的服务，注册通知函数的服务</li><li><code>Protocol使用类</code> 服务: <code>Protocol</code> 的打开与关闭，查找支持 <code>Protocol控制</code> ，例打开设备上 <code>PciloProtocol</code> , 用 <code>PciIo-&gt;Io.Read()</code> 服务读取设备上的 <code>寄存器</code></li><li><code>驱动管理</code> ：包括用于将驱动安装到控制器的 <code>connect服务</code> ，以及将驱动从控制器上 <code>卸载的disconnect服务</code> 。若启动时，需要网络服务，通过 loadImage 将驱动加载到内存，通过 <code>connect</code> 服务将驱动安装到设备</li><li><code>Image管理</code> ：加载，卸载，启动和退出 UEFI 应用程序或驱动</li><li><code>ExitBootServices</code> ：用于结束启动服务</li></ul><h2 id="rt提供的服务"><a class="anchor" href="#rt提供的服务">#</a> RT 提供的服务</h2><blockquote><p>UEFI 提供给操作系统的 <code>运行时</code> 服务</p></blockquote><ul><li><code>时间</code> 服务：读取 / 设定系统时间，</li><li>读取 <code>UEFI系统变量</code> ：读取 / 设置系统变量，例如 <code>BootOrder</code> 用于指定 <code>启动项顺序</code> ，通过系统变量保存系统配置</li><li><code>虚拟内存</code> 服务： 将 <code>物理地址</code> 转换为 <code>虚拟地址</code></li><li>其它服务：包含 <code>重启系统的ResetSystem</code> , 获取系统提供的 <code>下一个单调单增值</code> 。</li></ul><h1 id="uefi启动过程"><a class="anchor" href="#uefi启动过程">#</a> UEFI 启动过程</h1><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbuvDicPdvq9q8kCkj2w7H9wblJ3rlN5iaZxBFvonYAPvibATfhxJO6FlJs9EkIEG9fq3icq5w0g3PFIQQ/640?wx_fmt=pngg" alt="image-20230728095402333"></p><p><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ORog4TEnkbuvDicPdvq9q8kCkj2w7H9wbfhTKsXhA6WDK9qZNuVibGrvbHkyceW78cKCwE36UAxiaEBv5wyasWVpA/640?wx_fmt=jpeg" alt="启动过程任务"></p><h2 id="sec阶段"><a class="anchor" href="#sec阶段">#</a> SEC 阶段</h2><blockquote><p><code>Security Phase</code> , 当 CPU 收到 <code>ResetVector</code> 信号后，开始执行 <code>第一行</code> 代码， 平台初始化的第一个阶段，安全阶段， <code>最早</code> 运行的固件代码，此模块 <code>相当部分</code> 使用 <code>汇编</code> 语言开发。</p><p>电脑的开机或者重启， <code>本质</code> 上是给 CPU 发送了一个 <code>ResetVector</code> 信号。</p><p>由于 <code>没有初始化内</code> 存，会 <code>临时使用CPU</code> 的缓存，内嵌在 CPU 中，初始化好的，</p><p>SEC 作为整个系统执行的起点，可能遇到各种异常，就需要设置 <code>IDT</code> ，有了中断描述符表接受异常，就能让系统遭遇意外情况时，不至于崩溃，为 PEI 阶段设置临时 <code>内存的基地址和长度</code> 并传给 PEI，同时将 PEI 代码的入口点，将控制权移交过去，并且处理临时内存。</p><figure class="highlight sh"><figcaption data-lang="sh"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 位于 EDK2 如下目录</span></pre></td></tr><tr><td data-num="2"></td><td><pre>UefiCpuPkg/ResetVector/Vtf0</pre></td></tr></table></figure></blockquote><h3 id="sec阶段任务"><a class="anchor" href="#sec阶段任务">#</a> SEC 阶段任务</h3><blockquote><ul><li>接受并处理系统 <code>启动</code> 和 <code>重启</code> 信号，以及运行过程中的 <code>严重异常</code> 信号</li><li><code>初始</code> 化 <code>临时存储区域</code> ，启动系统需要的一些临时 <code>RAM</code> ，空间资源仍然 <code>稀缺</code></li><li>作为 <code>可信系统</code> 根传递给下一个 <code>阶段PEI</code></li></ul></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbuvDicPdvq9q8kCkj2w7H9wb1LbZ7X8c7pic9mKNmiaL1tCrcpMQ9pAicD6cGEnxaCBcke9WNzTdFcJBg/640?wx_fmt=png" alt="image-20230728111306147"></p><h3 id="reset-vector"><a class="anchor" href="#reset-vector">#</a> Reset Vector</h3><blockquote><ul><li>进入 <code>固件入口</code></li><li>…..</li></ul></blockquote><h2 id="pei阶段"><a class="anchor" href="#pei阶段">#</a> PEI 阶段</h2><blockquote><p>PEI : <code>Pre-EFI Initialization</code></p></blockquote><blockquote><ul><li><code>资源</code> 十分 <code>有限</code> ， <code>PEI后期</code> 进行内存 <code>初始化</code></li><li>为 <code>DXE</code> 准备执行环境，将需要传递的信息组成 <code>HOB</code> 列表，将控制权移交到 <code>DXE</code> 手中</li></ul></blockquote><ul><li><code>PEI Foundation</code> : 负责接受 <code>SEC</code> 发送的交换数据，并扮演 <code>模块分发</code> 的角色</li><li><code>PEIMs-EFI Initlization Modules</code> 是模块化的， <code>PEI</code> 阶段的 4 档事情就是交给 <code>PEIMs</code> 完成，完成后就来到了 <code>DXE阶段</code> 。</li></ul><blockquote><blockquote><p>对 <code>系统的初始化</code> ，找出系统中所有的 <code>PEIM</code> ，并根据 <code>PEIM</code> 之间的依赖关系按照顺序执行 <code>PEIM</code> ,</p></blockquote></blockquote><h3 id="pei入口函数"><a class="anchor" href="#pei入口函数">#</a> PEI 入口函数</h3><ul><li>系统当前的状态，判断 <code>系统健康状况</code></li><li>可启用 <code>固件的地址</code> 和 <code>大小</code></li><li>临时 <code>RAM区域</code> 的 <code>地址</code> 和 <code>大小</code></li><li><code>栈</code> 的 <code>地址</code> 和 <code>大小</code></li></ul><h3 id="pei执行流程"><a class="anchor" href="#pei执行流程">#</a> PEI 执行流程</h3><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbuvDicPdvq9q8kCkj2w7H9wbyfRUncfdRmpjMhWN2xoDBRjph0zgcRTwZm2NtlmfiakNWYBjF5YlzibA/640?wx_fmt=png" alt="FEI执行流程"></p><blockquote><p>在 <code>PEI</code> 阶段， <code>PEIM</code> ， <code>PPI</code> ， <code>HOM</code> 组成了 PEI 阶段，PEI 阶段的 <code>module</code> 可理解为 <code>Driver</code> 就是 <code>PEIM</code> ， <code>PEI阶段</code> 就是由一个一个的 PEIM 组成的； <code>PPI</code> 是 <code>PEIM</code> 之间相互调用的接口，由唯一的 <code>GUID</code> ( <code>全局统一标识符</code> ) 引导，内部也包含一些 <code>接口</code> ，HOB 相当于信件在 PEI 阶段创建，会记录当前系统的信息，可以 <code>自定义HOB</code> ，然后在 <code>DXE阶段读出</code></p></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbsMGpxMLgwLn51xNGAJSW4O6DbPW269kH3ia2YDqGZRGehM7A0vjrHkd2DNkOOYfKH3jtdQGsD4znQ/640?wx_fmt=png" alt="PEI阶段"></p><blockquote><p><code>PEIM</code> : <code>PEI Module</code> ，会被编译成 <code>efi binary</code></p><p>在一套的 <code>BIOS code</code> 编译完之后，进入到 <code>build目录</code> 就可以找到 <code>PEIM</code> 具体的 <code>efi</code></p><p><code>PPIs</code> ： <code>PEIM-to-PEIM Interfaces</code> ,PEIMs 被调用通过 <code>PPI</code> ， <code>Interface</code> 。调用函数必须通过 PPI 接口</p><ul><li>PPI 名称： <code>GUID</code> (128-bits)</li><li><code>PPIs</code> 结构体，PPI 就是一个结构体，可能包含的功能，数据。</li><li>PEIM 会把 PPI 注册到 <code>PEI Foundation</code> 。 （ <code>PEI Foundation</code> 管理着庞大的 <code>PPI</code> 数据库)</li></ul></blockquote><ul><li><code>Core Services</code> 包含后面 phase 用到的各种 Services。在 PEI 阶段 get 当前计算机启动的 boot Mode 有直接定义的 PEI Service 函数，在 DXE 以及后面的阶段要通过 HOB 方式通过 <code>get HOB LIS</code> T 然后拆解信息进行 <code>ge</code> 启动 <code>boot Mode</code></li><li><code>Core Dispatcher</code> 负责派发个 <code>PEIMs</code> , 将 <code>PEIM</code> 按照既定的顺序 <code>Load</code> 并执行， <code>Dependency</code> 顺序，就是 <code>inf</code> 文件里面的 <code>depx</code> , 满足条件可执行</li><li>各 <code>PEIM Entry</code> 可能使用其它 <code>PEIM</code> 和 <code>PPI</code></li><li><code>PEI Core</code> 最后会找到 <code>DXE</code> 获得之前 <code>phase Data</code> 是从 HOB 里拿到，PEI Core 会创建 HOB,PEI 和 DXE 都可以使用 <code>HOB的Data</code></li></ul><blockquote><p>函数:</p><ul><li><code>InstallPPI</code> 安装 PPI 到 <code>PEI foundation</code> , <code>Protocol install</code> 安装完毕后放到 <code>Handle Database</code> 里</li><li><code>LocatePPI()</code> ：根据 PPI 名称 <code>GUID</code> 从 <code>PEI foundation</code> 找 <code>Interface</code></li><li><code>NotifyPPI()</code> : PPI 里的 <code>function</code> 不会在派发时就执行，通知系统此 PPI 会在某个 PPI 被安装时才执行</li></ul></blockquote><h3 id="install-ppi"><a class="anchor" href="#install-ppi">#</a> Install PPI</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>  Install PPI services. It is implementation of EFI_PEI_SERVICE.InstallPpi.</pre></td></tr><tr><td data-num="4"></td><td><pre>  这是个 service，PEI foundation 提供的。 通过 GUID 安装。目的是让别人调用。</pre></td></tr><tr><td data-num="5"></td><td><pre>  @param PeiServices                An indirect pointer to the EFI_PEI_SERVICES table published by the PEI Foundation.</pre></td></tr><tr><td data-num="6"></td><td><pre>  标准格式，入口第一人参数是铁定的 EFI_PEI_SERVICES 指针</pre></td></tr><tr><td data-num="7"></td><td><pre>  @param PpiList                    Pointer to PPI array that want to be installed.</pre></td></tr><tr><td data-num="8"></td><td><pre>  第二个参数是 PPI List, LIST 里包括 Flag、GUID 和函数 参考.h 里的 EFI_PEI_PPI_DESCRIPTOR 定义</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  @retval EFI_SUCCESS               if all PPIs in PpiList are successfully installed.</pre></td></tr><tr><td data-num="11"></td><td><pre>  @retval EFI_INVALID_PARAMETER     if PpiList is NULL pointer</pre></td></tr><tr><td data-num="12"></td><td><pre>                                    if any PPI in PpiList is not valid</pre></td></tr><tr><td data-num="13"></td><td><pre>  @retval EFI_OUT_OF_RESOURCES      if there is no more memory resource to install PPI</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>**/</pre></td></tr><tr><td data-num="16"></td><td><pre>EFI_STATUS</pre></td></tr><tr><td data-num="17"></td><td><pre>EFIAPI</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token function">PeiInstallPpi</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  IN CONST EFI_PEI_SERVICES        <span class="token operator">*</span><span class="token operator">*</span>PeiServices<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  IN CONST EFI_PEI_PPI_DESCRIPTOR  <span class="token operator">*</span>PpiList</pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="hob"><a class="anchor" href="#hob">#</a> HOB</h3><blockquote><p>HOB( <code>Hand-Off Blocks</code> )：传输信息的载体， <code>PEI</code> 和 <code>DXE</code> 联系薄弱， <code>DXE</code> 需要知到 <code>PEI初始化</code> 的硬件内存等数据， <code>HOB</code> 作为 <code>桥梁</code> 。</p><p><code>HOB</code> 实际就是一个 <code>链表</code> ，当我们找到 hoblist 的头，那么整个链表的数据都能得到， <code>GetHobList()</code> 获取 <code>hoblist</code> 的 <code>指针</code> ，</p><ul><li>第 <code>一个HOB</code> 总是 <code>PHIT==Phase Handoff GetHobList(),</code> 里面是 <code>boot mode</code></li><li>其它 <code>HOB</code> 可能出现在 <code>List任意位置</code> ，最重要的是 <code>System Memory HOB &amp; Firmware Volumes</code> ， <code>HOB</code> 列表总是会以 <code>END_OF_HOB_LIST</code> 结束</li></ul></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbsMGpxMLgwLn51xNGAJSW4OX9O112gUia4BDVaFKNabwXA6egBbhLw68IpEicgdB2zIvhBEMibMfTDKQ/640?wx_fmt=png" alt="HOB链表"></p><h4 id="添加新的hob"><a class="anchor" href="#添加新的hob">#</a> 添加新的 HOB</h4><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  Add a new HOB to the HOB List.</pre></td></tr><tr><td data-num="3"></td><td><pre>  @param PeiServices        An indirect pointer to the EFI_PEI_SERVICES table published by the PEI Foundation.</pre></td></tr><tr><td data-num="4"></td><td><pre>  @param Type               Type of the new HOB.</pre></td></tr><tr><td data-num="5"></td><td><pre>  @param Length             Length of the new HOB to allocate.</pre></td></tr><tr><td data-num="6"></td><td><pre>  @param Hob                Pointer to the new HOB.</pre></td></tr><tr><td data-num="7"></td><td><pre>  @return  EFI_SUCCESS           Success to create HOB.</pre></td></tr><tr><td data-num="8"></td><td><pre>  @retval  EFI_INVALID_PARAMETER if Hob is NULL</pre></td></tr><tr><td data-num="9"></td><td><pre>  @retval  EFI_NOT_AVAILABLE_YET if HobList is still not available.</pre></td></tr><tr><td data-num="10"></td><td><pre>  @retval  EFI_OUT_OF_RESOURCES  if there is no more memory to grow the Hoblist.</pre></td></tr><tr><td data-num="11"></td><td><pre>**/</pre></td></tr><tr><td data-num="12"></td><td><pre>EFI_STATUS</pre></td></tr><tr><td data-num="13"></td><td><pre>EFIAPI</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">PeiCreateHob</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  IN CONST EFI_PEI_SERVICES  <span class="token operator">*</span><span class="token operator">*</span>PeiServices<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  IN UINT16            Type<span class="token punctuation">,</span> <span class="token comment">// 对于自定义的 HOB 一般使用 EFI_HOB_GUID_TYPE</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  IN UINT16            Length<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  IN OUT VOID          <span class="token operator">*</span><span class="token operator">*</span>Hob</pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="dxe阶段"><a class="anchor" href="#dxe阶段">#</a> DXE 阶段</h2><blockquote><p><code>Driver Execution Environment</code> 驱动执行环境，主要任务是把基本驱动程序加载起来，建立两者之间的联系。</p><p>执行 <code>大部分系统初始化</code> 的工作，此阶段内存已经 <code>完全</code> 被 <code>初始化</code> ，</p><ul><li><code>DXE内核</code> ：复杂 DEX 基础服务和执行流程</li><li><code>DXE派遣器</code> ：负责调度执行 <code>EXE驱动</code> ，初始化系统 <code>设备</code></li></ul></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbuvDicPdvq9q8kCkj2w7H9wbS0m2x5v1ZMRKOBXZQfskLSrVBlUPNq1emzZ58ohcW3pnpt4v6goDcg/640?wx_fmt=png" alt="DXE阶段执行流程"></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token function">EFI_STATUS</span><span class="token punctuation">(</span>EFIAPI <span class="token operator">*</span>EFI_IMAGE_ENTRY_POINT<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    IN EFI_HANDLE ImageHandle<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    IN EFI_SYSTEM_TABLE <span class="token operator">*</span>SystemTable</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p><code>驱动</code> 之间通过 <code>Protocol</code> 进行通信。</p><ul><li><code>Protocol</code> 特殊结构体保存着对应的 <code>GUID</code> ，利用系统 <code>BootServices</code> 的 <code>OpenProtocol</code> ，并根据 <code>GUID</code> 打开对应的 <code>Protocol</code> ，进而使用 <code>对应的服务</code> 。当所有的 <code>driver</code> 执行 <code>完毕</code> ，系统 <code>完成初始化</code> ，</li></ul></blockquote><h2 id="dxe-core"><a class="anchor" href="#dxe-core">#</a> DXE Core</h2><blockquote><p><code>DxeMain()</code> 是 DXE 阶段执行的 <code>主函数</code> ，同时以 <code>参数形式</code> 接受 PEI 阶段的 <code>HOB表</code></p><ul><li>创建 <code>EFI System Table</code> 在随后的 <code>DXE Drive</code> r 中逐步完善 table</li><li>生成 <code>Boot Services / Run Time Services / DXE Services</code></li><li>调用 <code>Dispatcher</code> ，所有的 <code>DXE Driver</code> 在这个函数中 <code>被检测</code> 并 <code>执行</code></li><li><code>Driver</code> 执行完毕之后，执行特殊的 <code>DXE Driver</code> 进而进入 BDS 阶段</li></ul></blockquote><h2 id="dxe-dispatcher"><a class="anchor" href="#dxe-dispatcher">#</a> DXE Dispatcher</h2><blockquote><ul><li>去 <code>BIOS</code> 芯片中搜寻 <code>DXE Driver</code></li><li>检测并按照相应的顺序执行所有的 <code>DXE Driver</code> , 在每个 <code>driver</code> 的 <code>inf</code> 文件的 <code>driver</code> 依赖条件都成立时，该 driver 才被执行</li></ul></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbsMGpxMLgwLn51xNGAJSW4OR3tzH7e6icgianicWicSRrI0JYlhlq7Z3vngbcHfm5Yk8OUrKo47c1pBug/640?wx_fmt=png" alt="DXE Dispatcher"></p><h2 id="bds阶段"><a class="anchor" href="#bds阶段">#</a> BDS 阶段</h2><blockquote><p>全程： <code>Boot Device Select</code></p><p>U 盘就是寻找具有 <code>FAT32分区</code> 的设备</p><p>执行启动策略 BDS 三大任务： <code>console初始化</code> ， <code>Driver初始化</code> ， <code>BootDeviceSelect</code> ：用户选择 <code>BDS加载</code> 启动选项里的 <code>OS loader</code> ，最后移交真正的 <code>控制权</code> 给 <code>OS loader</code> ，由 OS Loader 将</p><ul><li>初始化控制台设备：查看系统有 <code>多少</code> 加载必要的设备驱动：启动所有检测到的设备，加载 <code>driver</code></li><li>根据系统设置加载和执行启动项 (若加载失败，系统将重新执行 <code>DXE dispatcher</code> 以加载更多的 <code>驱动</code> ，然后重新尝试加载 <code>启动项</code> )</li></ul></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbsMGpxMLgwLn51xNGAJSW4OOvq9BXxGNrBA0viaNOtqVZzWeYVFibYXx1ibOg6DtH3Brx3L7ms99ZkwA/640?wx_fmt=png" alt="DXE执行流程"></p><h2 id="bds-steps"><a class="anchor" href="#bds-steps">#</a> BDS Steps</h2><ul><li>初始化 <code>语言</code> 和 <code>字符串</code> 数据库</li><li>获得 <code>当前启动模式</code></li><li>基于 <code>启动模式</code> 建立 <code>设备清单</code></li><li>连接 <code>设备</code></li><li>检测 <code>input output</code> 设备</li><li>执行 <code>内存测试</code></li><li>进程 <code>引导选项</code></li></ul><p><img data-src="https://mmbiz.qpic.cn/mmbiz_png/ORog4TEnkbsMGpxMLgwLn51xNGAJSW4OicbYiaR9MNVKye0RgZibv9JhlT9slvgyn0dxCpMiavqXuIvpr3zd6HzYsg/640?wx_fmt=png" alt="BDS Steps"></p><h2 id="tsl阶段"><a class="anchor" href="#tsl阶段">#</a> TSL 阶段</h2><blockquote><p><code>Transient System Load</code> : 操作系统 <code>OS Loader</code> 执行的第 <code>一阶段</code> ，首先作为 <code>UEFI</code> 程序运行，之后 TSL 退出，系统进入 <code>Run Time</code> 阶段。OS loader 的主战场，TSL 是正式操作系统加载前的预备阶段，需要 Loader 找到并加载 OS</p></blockquote><h2 id="rt阶段"><a class="anchor" href="#rt阶段">#</a> RT 阶段</h2><blockquote><p><code>Run Time</code> : 系统控制权从 <code>UEFI</code> 内核转交到 <code>OS Loader</code> 手中，UEFI 资源回收到 OS Loader。在 OS Loader 中 OS 获取系统控制权。</p></blockquote><h2 id="al阶段"><a class="anchor" href="#al阶段">#</a> AL 阶段</h2><blockquote><p><code>After Life</code> 如果系统 / 软件遇到灾难性错误，系统固件需要提供错误处理和灾难性恢复机制，此机制运行在 <code>AL</code> (After Life) 阶段。</p><p>由 <code>常驻UEFI</code> 驱动组成，计算机 <code>关机</code> 休眠 <code>睡眠</code> 重启过程中的系统信息都会在这一阶段 <code>保存</code> 。</p></blockquote><h1 id="源码部分基础"><a class="anchor" href="#源码部分基础">#</a> 源码部分基础</h1><h2 id="源码类型定义"><a class="anchor" href="#源码类型定义">#</a> 源码类型定义</h2><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> __int64  UINT64<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">typedef</span> __int64           INT64<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> __int32  UINT32<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">typedef</span> __int32           INT32<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span>    UINT16<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span>    CHAR16<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">short</span>             INT16<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span>     BOOLEAN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span>     UINT8<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">char</span>              CHAR8<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">signed</span> <span class="token keyword">char</span>       INT8<span class="token punctuation">;</span></pre></td></tr></table></figure><h1 id="一些硬件补充"><a class="anchor" href="#一些硬件补充">#</a> 一些硬件补充</h1><h2 id="hardware-monitor"><a class="anchor" href="#hardware-monitor">#</a> Hardware Monitor</h2><blockquote><p>读出所有计算进访问 <code>传感器</code> 的 <code>测试值</code></p><ul><li>不同地点的 <code>temperature</code> 读数 <code>CPU and system temperature</code></li><li><code>智能风扇</code> 控制：风扇转速侦测和风扇控制输出</li><li><code>电压监控</code></li></ul></blockquote><h2 id="分时复用"><a class="anchor" href="#分时复用">#</a> 分时复用</h2><blockquote><p>是采用 <code>一物理链接</code> 的不同时段来传输不同 <code>的信号</code> ，能达到 <code>多路复用</code> 的目的。通过事件上 <code>交叉</code> 发送每一路信号的一部分来实现一条电路传送多路信号。</p><p>将整个传输时间分割为 <code>互不重叠</code> 的时间间隔，又称为 <code>时隙</code></p><ul><li>同步分时复用（ <code>STDM</code> ， <code>Synchronous Time Division Multiplexing</code> ）：采用 <code>固定间隙</code> 分配方式，即将传输信号按特定长度连续地 <code>划分特定</code> 的时间段或者一个 <code>周期</code></li><li>异步分时复用（<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9BVERNP2Zyb21Nb2R1bGU9bGVtbWFfaW5saW5r">ATDM</span>， <code>Asynchronous Time Division Multiplexing</code> ）：根据用户市级需要动态分配资源的分时复用记数。</li></ul></blockquote><h2 id="pci"><a class="anchor" href="#pci">#</a> PCI</h2><blockquote><ul><li>局部总线：局部总线是在 <code>ISA</code> 和 <code>CPU总线</code> 之间添加 <code>一级总</code> 线或 <code>管理层</code> 。这样可将一些 <code>高速外设如图形卡</code> ，硬件控制器等从 ISA 总线上卸下而通过局部总线直接挂接在 CPU 总线上，使之余高速能与 CPU 总线相匹配。</li><li>PCI (Peripheral Component Interconnect) ： <code>Intel 1991</code> 年推出的用于定义 <code>局部总线</code> 的标准。 <code>PCI</code> 不同于 ISA 总线，PCI 数据地址总线于数据总线是分时复用。以方便可以节省接插件的管脚数，另一方便便于实现数据传输。</li></ul></blockquote><h2 id="usb"><a class="anchor" href="#usb">#</a> USB</h2><blockquote><p><code>USB总线</code> 提供 <code>中低速率</code> 外围设备的扩充能力，像键盘，鼠标，遥感，喇叭，麦克风等设备，只要是 USB 接口设计，就可以以 <code>热拔插</code> （ <code>Hot Plug</code> ) 的方式，直接跟计算机连接或拆除 (离线)，计算机与 <code>OS会自动检测</code> 并启用 / 禁用该设备，达到真正的即插即用。</p><p>新近的 <code>BIOS</code> 直接提供了 <code>USB设备驱动</code> 与 <code>读写</code> 功能，比如开始就可以使用 <code>USB键盘</code> ， <code>鼠标</code> 以及 <code>USB软盘</code> ，硬盘甚至 <code>USB CD-ROM</code> 来开机。</p></blockquote><h2 id="acpi-2"><a class="anchor" href="#acpi-2">#</a> ACPI</h2><blockquote><p>高级配置和电源管理接口： <code>Advance Configuration and Power Management Interface</code> . 早先 ACPI 将电源管理几乎全部分配给了 <code>BIOS控制</code> ，限制了 <code>操作系统</code> 在控制电脑。系统可能进入 <code>极地功耗</code> 消耗状态，这些就是可利用多数桌面型电脑上睡眠和休眠设置</p><p>节电方式：</p><ul><li>显示屏 <code>自动断电</code></li><li>系统把当前信息存储在 <code>内存</code> 中，只有内存等几个关键部件通电，即挂起到内存</li><li><code>挂起到硬盘</code> ，计算机自 <code>动关机</code> ，关机千将当前数据存储在硬盘上。</li></ul></blockquote><h2 id="中断向量表"><a class="anchor" href="#中断向量表">#</a> 中断向量表</h2><blockquote><p><code>中断向量表</code> 在 <code>内存</code> 中保存，其中放着 <code>256个中断源</code> 所对应的中断处理程序入口</p></blockquote><p><img data-src="https://mmbiz.qpic.cn/mmbiz_jpg/ORog4TEnkbsMGpxMLgwLn51xNGAJSW4OcHYjxhm261gnSf5DY7mFGicKpHo98xz2CCLpz7ds97moEWjrCzpsIZQ/640?wx_fmt=webp" alt="什么是中断向量表"></p><h2 id="英语"><a class="anchor" href="#英语">#</a> 英语</h2><ul><li><code>Keyboard Power On</code> : 键盘开机</li><li><code>Wake on LAN</code> ： 网卡遥控开机</li><li>调制解调器 / 传真机来电开机（ <code>Modem Ring On</code> )</li><li>CPU 过热防护： <code>CPU Overheat Protection</code></li><li>超频功能： <code>Overclocking</code></li></ul><h1 id="参考资料"><a class="anchor" href="#参考资料">#</a> 参考资料</h1><ul><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMyOTA3MTk1L2FydGljbGUvZGV0YWlscy8xMTY0NTA0MDQ=">什么是 BMC</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dteDE5OTI/dHlwZT1ibG9n">gxh1992 博客</span></li><li>《UEFI 原理与编程》</li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTI3OTA2My9hcnRpY2xlL2RldGFpbHMvMTIwMTk0MzAx">PEI 阶段扩展</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTI3OTA2My9hcnRpY2xlL2RldGFpbHMvMTE1NTA4OTYx">DXE</span></li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxODczMTkyL2FydGljbGUvZGV0YWlscy8xMjU5NjY0NTc=">图表化呈现</span></li></ul><div class="tags"><a href="/tags/BIOS/" rel="tag"><i class="ic i-tag"></i>BIOS</a><a href="/tags/UEFI/" rel="tag"><i class="ic i-tag"></i>UEFI</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="BIOS/UEFI七阶段/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2023-07-29 10:56:53" itemprop="dateModified" datetime="2023-07-29T10:56:53+08:00">2023-07-29</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/assets/wechatpay.png" alt="YuHeShui 微信支付"><p>微信支付</p></div><div><img data-src="/assets/alipay.png" alt="YuHeShui 支付宝"><p>支付宝</p></div><div><img data-src="/assets/paypal.png" alt="YuHeShui 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>YuHeShui<i class="ic i-at"><em>@</em></i>瓶子的跋涉</li><li class="link"><strong>本文链接：</strong><a href="https://www.blog.foryouos.cn/BIOS/UEFI%E4%B8%83%E9%98%B6%E6%AE%B5/" title="UEFI概述">https://www.blog.foryouos.cn/BIOS/UEFI七阶段/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/BIOS/EDK2%E4%B8%8E%E5%8F%8C%E7%B3%BB%E7%BB%9F/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;i.imgtg.com&#x2F;2023&#x2F;07&#x2F;29&#x2F;OimFTp.jpg" title="EDK2安装与双系统"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>BIOS</span><h3>EDK2安装与双系统</h3></a></div><div class="item right"></div></div><div class="wrap" id="wcomments"></div><script type="module" data-pjax="data-pjax">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';

setTimeout(function () {
    init({
        el: '#wcomments',
        serverURL: 'https://foryouos.netlify.app/.netlify/functions/comment',
        lang: 'zh-CN',
        locale: {},
        emoji: ["https://unpkg.com/@waline/emojis@1.0.1/weibo","https://unpkg.com/@waline/emojis@1.0.1/alus","https://unpkg.com/@waline/emojis@1.0.1/bilibili","https://unpkg.com/@waline/emojis@1.0.1/qq","https://unpkg.com/@waline/emojis@1.0.1/tieba","https://unpkg.com/@waline/emojis@1.0.1/tw-emoji"],
        meta: ["nick","mail","link"],
        requiredMeta: ["nick","mail"],
        wordLimit: 0,
        pageSize: 10,
        pageview: true,
        path: window.location.pathname,
        dark: 'html[data-theme="dark"]'
    });
}, 1000)</script></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#bios%E9%98%B6%E6%AE%B5%E5%88%92%E5%88%86"><span class="toc-number">1.</span> <span class="toc-text">BIOS 阶段划分</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8Ebmc%E9%80%9A%E4%BF%A1"><span class="toc-number">2.</span> <span class="toc-text">与 BMC 通信</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BA%86%E8%A7%A3"><span class="toc-number">2.1.</span> <span class="toc-text">基础了解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86"><span class="toc-number">2.1.1.</span> <span class="toc-text">平台管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ipmi"><span class="toc-number">2.1.2.</span> <span class="toc-text">IPMI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bios%E9%80%9A%E4%BF%A1"><span class="toc-number">2.2.</span> <span class="toc-text">BIOS 通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E6%9E%9Cbmc%E4%B8%8Ebios%E4%BA%A7%E7%94%9F%E4%BA%86%E9%80%9A%E4%BF%A1%E6%95%85%E9%9A%9C"><span class="toc-number">2.3.</span> <span class="toc-text">如果 BMC 与 BIOS 产生了通信故障</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acpi"><span class="toc-number">3.</span> <span class="toc-text">ACPI</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#os-loader"><span class="toc-number">4.</span> <span class="toc-text">OS Loader</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#uefi"><span class="toc-number">5.</span> <span class="toc-text">UEFI</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E6%88%90"><span class="toc-number">6.</span> <span class="toc-text">组成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bs%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9C%8D%E5%8A%A1tsl%E9%98%B6%E6%AE%B5"><span class="toc-number">6.1.</span> <span class="toc-text">BS 提供的服务 (TSL 阶段)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rt%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">6.2.</span> <span class="toc-text">RT 提供的服务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#uefi%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text">UEFI 启动过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sec%E9%98%B6%E6%AE%B5"><span class="toc-number">7.1.</span> <span class="toc-text">SEC 阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sec%E9%98%B6%E6%AE%B5%E4%BB%BB%E5%8A%A1"><span class="toc-number">7.1.1.</span> <span class="toc-text">SEC 阶段任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reset-vector"><span class="toc-number">7.1.2.</span> <span class="toc-text">Reset Vector</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pei%E9%98%B6%E6%AE%B5"><span class="toc-number">7.2.</span> <span class="toc-text">PEI 阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pei%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.1.</span> <span class="toc-text">PEI 入口函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pei%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">7.2.2.</span> <span class="toc-text">PEI 执行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#install-ppi"><span class="toc-number">7.2.3.</span> <span class="toc-text">Install PPI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hob"><span class="toc-number">7.2.4.</span> <span class="toc-text">HOB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%9A%84hob"><span class="toc-number">7.2.4.1.</span> <span class="toc-text">添加新的 HOB</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dxe%E9%98%B6%E6%AE%B5"><span class="toc-number">7.3.</span> <span class="toc-text">DXE 阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dxe-core"><span class="toc-number">7.4.</span> <span class="toc-text">DXE Core</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dxe-dispatcher"><span class="toc-number">7.5.</span> <span class="toc-text">DXE Dispatcher</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bds%E9%98%B6%E6%AE%B5"><span class="toc-number">7.6.</span> <span class="toc-text">BDS 阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bds-steps"><span class="toc-number">7.7.</span> <span class="toc-text">BDS Steps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tsl%E9%98%B6%E6%AE%B5"><span class="toc-number">7.8.</span> <span class="toc-text">TSL 阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rt%E9%98%B6%E6%AE%B5"><span class="toc-number">7.9.</span> <span class="toc-text">RT 阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#al%E9%98%B6%E6%AE%B5"><span class="toc-number">7.10.</span> <span class="toc-text">AL 阶段</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E9%83%A8%E5%88%86%E5%9F%BA%E7%A1%80"><span class="toc-number">8.</span> <span class="toc-text">源码部分基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">8.1.</span> <span class="toc-text">源码类型定义</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E7%A1%AC%E4%BB%B6%E8%A1%A5%E5%85%85"><span class="toc-number">9.</span> <span class="toc-text">一些硬件补充</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hardware-monitor"><span class="toc-number">9.1.</span> <span class="toc-text">Hardware Monitor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%97%B6%E5%A4%8D%E7%94%A8"><span class="toc-number">9.2.</span> <span class="toc-text">分时复用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pci"><span class="toc-number">9.3.</span> <span class="toc-text">PCI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usb"><span class="toc-number">9.4.</span> <span class="toc-text">USB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#acpi-2"><span class="toc-number">9.5.</span> <span class="toc-text">ACPI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E5%90%91%E9%87%8F%E8%A1%A8"><span class="toc-number">9.6.</span> <span class="toc-text">中断向量表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E8%AF%AD"><span class="toc-number">9.7.</span> <span class="toc-text">英语</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">10.</span> <span class="toc-text">参考资料</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/BIOS/BIOS%E4%B8%8E%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8/" rel="bookmark" title="BIOS与系统启动">BIOS与系统启动</a></li><li><a href="/BIOS/EDK2%E4%B8%8E%E5%8F%8C%E7%B3%BB%E7%BB%9F/" rel="bookmark" title="EDK2安装与双系统">EDK2安装与双系统</a></li><li class="active"><a href="/BIOS/UEFI%E4%B8%83%E9%98%B6%E6%AE%B5/" rel="bookmark" title="UEFI概述">UEFI概述</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="YuHeShui" data-src="/assets/avatar.jpg"><p class="name" itemprop="name">YuHeShui</p><div class="description" itemprop="description">瓶子的跋涉 & 编程笔记</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">64</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">35</span><span class="name">标签</span></a></div></nav><div class="social"><a href="https://github.com/foryouos" class="item github" rel="noopener external nofollow noreferrer" title="https:&#x2F;&#x2F;github.com&#x2F;foryouos" target="_blank"><i class="ic i-github"></i></a><a href="https://www.zhihu.com/people/foryouos" class="item zhihu" rel="noopener external nofollow noreferrer" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;foryouos" target="_blank"><i class="ic i-zhihu"></i></a><a href="mailto:foryouos@mail.com" class="item email" rel="noopener external nofollow noreferrer" title="mailto:foryouos@mail.com" target="_blank"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);" rel="external nofollow noreferrer"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);" rel="external nofollow noreferrer"><i class="ic i-user"></i>外链</a><ul class="submenu"><li class="item"><a href="https://www.foryouos.cn/" rel="noopener external nofollow noreferrer" target="_blank"><i class="ic i-user"></i>主页</a></li><li class="item"><a href="https://www.so.foryouos.cn/" rel="noopener external nofollow noreferrer" target="_blank"><i class="ic i-magic"></i>搜索</a></li><li class="item"><a href="https://imgtg.com/foryouos" rel="noopener external nofollow noreferrer" target="_blank"><i class="ic i-coffee"></i>图库</a></li></ul></li></div></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/BIOS/EDK2%E4%B8%8E%E5%8F%8C%E7%B3%BB%E7%BB%9F/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/Linux/" title="分类于Linux">Linux</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/Linux/cmake/">Cmake笔记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/Linux/" title="分类于Linux">Linux</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/Linux/Linux%E5%A5%97%E6%8E%A5%E5%AD%97%E9%80%9A%E4%BF%A1TCP/">套接字通信 TCP</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/Linux/" title="分类于Linux">Linux</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/Linux/Linux%E4%BF%A1%E5%8F%B7/">linux信号</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/Linux/" title="分类于Linux">Linux</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/Linux/linux%E5%85%A5%E9%97%A8(1)/">linux入门1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Certificate/" title="分类于考证">考证</a><i class="ic i-angle-right"></i><a href="/categories/Certificate/soft/" title="分类于软件">软件</a><i class="ic i-angle-right"></i><a href="/categories/Certificate/soft/work/" title="分类于工作">工作</a><i class="ic i-angle-right"></i></div><span><a href="/Certificate/soft/work/%E7%AC%94%E8%AF%9503%E6%8C%87%E9%92%88%E7%B1%BB%E8%80%83%E9%A2%98/">笔试指针类考题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/Linux/" title="分类于Linux">Linux</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/Linux/LinuxIO%E5%A4%9A%E8%B7%AF%E8%BD%AC%E6%8E%A5/">linux IO多路复用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Certificate/" title="分类于考证">考证</a><i class="ic i-angle-right"></i><a href="/categories/Certificate/soft/" title="分类于软件">软件</a><i class="ic i-angle-right"></i><a href="/categories/Certificate/soft/work/" title="分类于工作">工作</a><i class="ic i-angle-right"></i></div><span><a href="/Certificate/soft/work/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">内存管理</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/" title="分类于C++">C++</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/course-1/" title="分类于郑莉老师C++语言程序设计">郑莉老师C++语言程序设计</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/cpp/course-1/cpp%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB%E4%B8%8E%E4%BF%9D%E6%8A%A4/">C++数据共享与保护</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/" title="分类于C++">C++</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/cpp/course-2/" title="分类于汇编与STl新特征">汇编与STl新特征</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/cpp/course-2/%E7%BB%91%E5%AE%9A%E5%99%A8%E5%8C%85%E8%A3%85%E5%99%A8/">C++11新特性绑定器包装器</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于计算机科学">计算机科学</a><i class="ic i-angle-right"></i><a href="/categories/computer-science/Git/" title="分类于Git分布式版本控制">Git分布式版本控制</a><i class="ic i-angle-right"></i></div><span><a href="/computer-science/Git/GitHub%E4%B8%AA%E6%80%A7%E5%8C%96%E8%AE%BE%E7%BD%AE/">github个性化设置</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"><li class="item" v-for="com in coms"><a v-bind:href="root + com.href" data-pjax-state="data-pjax-state"><span class="breadcrumb">{{com.nick}} @ {{com.time}}</span><span>{{com.text}}<br></span></a></li></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2023</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">YuHeShui @ foryouos</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">710k 字</span><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">10:45</span></div><div class="powered-by">基于 <a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> & Theme.<a href="https://github.com/theme-shoka-x/hexo-theme-shokaX/" rel="noopener external nofollow noreferrer" target="_blank">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"BIOS/UEFI七阶段/",favicon:{show:"不负韶华",hide:"以梦为马！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,chart:!1,copy_tex:!1,katex:!1,mermaid:!1,audio:"",fancybox:!0,nocopy:!1,outime:!0,template:"&lt;div class=&quot;note warning&quot;&gt;&lt;p&gt;&lt;span class=&quot;label warning&quot;&gt;文章时效性提示&lt;/span&gt;&lt;br&gt;这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。&lt;/p&gt;&lt;/div&gt;",quiz:{choice:"单选题",multiple:"多选题",true_false:"判断题",essay:"问答题",gap_fill:"填空题",mistake:"错题备注"},ignores:[t=>t.includes("#"),t=>new RegExp(LOCAL.path+"$").test(t),[]]}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=default,fetch"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.0.2/pace.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/instantsearch.js/4.39.0/instantsearch.production.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/quicklink/2.2.0/quicklink.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/??jquery/3.5.1/jquery.min.js,fancybox/3.5.7/jquery.fancybox.min.js,justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" async></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/KaTeX/0.12.0/contrib/copy-tex.min.js" async></script><script src="https://unpkg.com/theme-shokax-pjax@latest/pjax.shokax.min.js"></script><script src="https://unpkg.com/theme-shokax-anime@latest/anime.shokax.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/lozad.js/1.16.0/lozad.min.js"></script><script src="https://unpkg.com/frappe-charts@1.5.0/dist/frappe-charts.min.iife.js"></script><script src="/js/app.js?v=0.3.3"></script><script data-pjax="data-pjax">var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?e3ba29befb93fdf32bbc553d0e5bee92",e.async=!0,document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><script type="module" data-pjax>let items = []
        import { RecentComments } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs'
        RecentComments({
          serverURL: 'https://foryouos.netlify.app/.netlify/functions/comment',
          count: 10,
        }).then(({ comments }) => {
          comments.forEach(function (item) {
              let cText = (item.orig.length > 50) ? item.orig.substring(0,50)+'...' : item.orig
              item.url = item.url !== '/' ?  '/' + item.url : item.url;
              const siteLink = item.url + "#" + item.objectId
              items.push({
                  href: siteLink,
                  nick: item.nick,
                  time: item.insertedAt.split('T').shift(),
                  text: cText
              })
          })
          Vue.createApp({
            data() {
                return {
                    coms: items,
                    root: ''
                }
            }
          }).mount('#new-comment')
        }).catch(function (err) {
          console.error(err)
        })</script></body></html><!-- rebuild by hexo-renderer-multi-next-markdown-it -->